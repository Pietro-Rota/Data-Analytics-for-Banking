<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.7.24">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Pietro Rota">

<title>Data Analytics for Banking Coursework</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script><script src="Groupwork_files/libs/clipboard/clipboard.min.js"></script>
<script src="Groupwork_files/libs/quarto-html/quarto.js" type="module"></script>
<script src="Groupwork_files/libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="Groupwork_files/libs/quarto-html/popper.min.js"></script>
<script src="Groupwork_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="Groupwork_files/libs/quarto-html/anchor.min.js"></script>
<link href="Groupwork_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="Groupwork_files/libs/quarto-html/quarto-syntax-highlighting-a37c72dd2dbac68997fcdc15a3622e78.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="Groupwork_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="Groupwork_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="Groupwork_files/libs/bootstrap/bootstrap-abcefaed3b5d0dd009744ac446e232b3.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script>

<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>


</head>

<body class="quarto-light">

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">
<div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
  <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#prices" id="toc-prices" class="nav-link active" data-scroll-target="#prices">PRICES</a>
  <ul class="collapse">
  <li><a href="#descriptive-statistics-table" id="toc-descriptive-statistics-table" class="nav-link" data-scroll-target="#descriptive-statistics-table">Descriptive statistics table</a></li>
  </ul></li>
  <li><a href="#ratios" id="toc-ratios" class="nav-link" data-scroll-target="#ratios">RATIOS</a>
  <ul class="collapse">
  <li><a href="#scatter-with-groups" id="toc-scatter-with-groups" class="nav-link" data-scroll-target="#scatter-with-groups">Scatter with groups</a></li>
  <li><a href="#without-panel-regressions" id="toc-without-panel-regressions" class="nav-link" data-scroll-target="#without-panel-regressions">without panel regressions</a></li>
  <li><a href="#esg" id="toc-esg" class="nav-link" data-scroll-target="#esg">ESG</a>
  <ul class="collapse">
  <li><a href="#growth" id="toc-growth" class="nav-link" data-scroll-target="#growth">Growth</a></li>
  </ul></li>
  </ul></li>
  </ul>
</nav>
</div>
<main class="content page-columns page-full" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<div class="quarto-title-block"><div><h1 class="title">Data Analytics for Banking Coursework</h1><button type="button" class="btn code-tools-button dropdown-toggle" id="quarto-code-tools-menu" data-bs-toggle="dropdown" aria-expanded="false"><i class="bi"></i> Code</button><ul class="dropdown-menu dropdown-menu-end" aria-labelelledby="quarto-code-tools-menu"><li><a id="quarto-show-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Show All Code</a></li><li><a id="quarto-hide-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Hide All Code</a></li></ul></div></div>
</div>


<div class="quarto-title-meta-author">
  <div class="quarto-title-meta-heading">Author</div>
  <div class="quarto-title-meta-heading">Affiliation</div>
  
    <div class="quarto-title-meta-contents">
    <p class="author">Pietro Rota </p>
  </div>
  <div class="quarto-title-meta-contents">
        <p class="affiliation">
            <a href="https://www.bayes.citystgeorges.ac.uk/">
            Bayes Business School – City, St George’s University of London
            </a>
          </p>
      </div>
  </div>

<div class="quarto-title-meta">

      
  
    
  </div>
  


</header>


<p><strong>TO RENDER CORRECTLY</strong>:</p>
<p>quarto preview “c:/Users/pietr/OneDrive - City St George’s, University of London/Documents/a2025-2026 BAYES/DABF - Data Analytics for Banking &amp; Finance/DABF_code/Groupwork/Groupwork.ipynb” –to html –no-watch-inputs –execute</p>
<div id="setup" class="cell" data-execution_count="1">
<details class="code-fold">
<summary>Show code</summary>
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> scipy.stats <span class="im">import</span> jarque_bera</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> statsmodels.tsa.stattools <span class="im">import</span> adfuller</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> datetime <span class="im">import</span> datetime</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> statsmodels.api <span class="im">import</span> OLS, add_constant</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> great_tables <span class="im">import</span> GT</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> seaborn <span class="im">as</span> sns</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Current Time:"</span>, datetime.now())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Current Time: 2025-11-27 11:28:23.191353</code></pre>
</div>
</div>
<section id="prices" class="level1 page-columns page-full">
<h1>PRICES</h1>
<div id="cell-import_prices" class="cell" data-execution_count="2">
<details class="code-fold">
<summary>Show code</summary>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> pathlib <span class="im">import</span> Path</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>PATH <span class="op">=</span> Path(<span class="st">"C:/Users/pietr/OneDrive - City St George's, University of London/Documents/a2025-2026 BAYES/DABF - Data Analytics for Banking &amp; Finance/DABF_code/Groupwork/DF5.xlsx"</span>)</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> pd.read_excel(PATH, sheet_name<span class="op">=</span><span class="st">"PRICES GBP"</span>)</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a><span class="co"># df['Date'] = pd.to_datetime(df['Date'], unit='D')</span></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>df.set_index(<span class="st">'Date'</span>, inplace<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> df.astype(<span class="bu">float</span>)</span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Inspect the data</span></span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> df.dropna()</span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a>df.<span class="bu">round</span>(<span class="dv">4</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div id="import_prices" class="cell-output cell-output-display" data-execution_count="2">
<div>

<table class="dataframe table table-sm table-striped small">
  <thead>
    <tr>
      <th></th>
      <th>CVX US Equity</th>
      <th>FSLR US Equity</th>
      <th>ENI IM Equity</th>
      <th>XOM US Equity</th>
      <th>SHEL LN Equity</th>
      <th>VWS DC Equity</th>
      <th>EQNR NO Equity</th>
      <th>TTE FP Equity</th>
      <th>AMRC US Equity</th>
      <th>NEE US Equity</th>
      <th>SPX Index</th>
    </tr>
    <tr>
      <th>Date</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2024-11-01</th>
      <td>22.6098</td>
      <td>158.5241</td>
      <td>11.7630</td>
      <td>88.9155</td>
      <td>25.790</td>
      <td>14.9066</td>
      <td>18.1238</td>
      <td>48.5307</td>
      <td>25.0077</td>
      <td>59.8314</td>
      <td>4431.3119</td>
    </tr>
    <tr>
      <th>2024-11-04</th>
      <td>22.9469</td>
      <td>163.8469</td>
      <td>11.7849</td>
      <td>91.5483</td>
      <td>25.940</td>
      <td>15.3201</td>
      <td>18.2802</td>
      <td>48.8139</td>
      <td>25.8413</td>
      <td>60.4893</td>
      <td>4409.3007</td>
    </tr>
    <tr>
      <th>2024-11-05</th>
      <td>22.9860</td>
      <td>165.6360</td>
      <td>11.8373</td>
      <td>91.2690</td>
      <td>26.085</td>
      <td>13.4186</td>
      <td>18.2319</td>
      <td>48.8806</td>
      <td>27.1597</td>
      <td>60.3422</td>
      <td>4436.6733</td>
    </tr>
    <tr>
      <th>2024-11-06</th>
      <td>23.3980</td>
      <td>150.5198</td>
      <td>11.6541</td>
      <td>93.8712</td>
      <td>25.925</td>
      <td>11.6121</td>
      <td>17.4024</td>
      <td>47.9095</td>
      <td>24.9418</td>
      <td>57.8123</td>
      <td>4599.7207</td>
    </tr>
    <tr>
      <th>2024-11-07</th>
      <td>23.3179</td>
      <td>151.4242</td>
      <td>11.7200</td>
      <td>93.2640</td>
      <td>25.995</td>
      <td>11.9894</td>
      <td>17.7310</td>
      <td>48.0278</td>
      <td>24.3572</td>
      <td>57.4442</td>
      <td>4598.2294</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>2025-10-27</th>
      <td>26.0762</td>
      <td>185.7582</td>
      <td>13.9143</td>
      <td>86.9507</td>
      <td>28.320</td>
      <td>14.3080</td>
      <td>18.3293</td>
      <td>46.9308</td>
      <td>31.1609</td>
      <td>64.5193</td>
      <td>5156.1122</td>
    </tr>
    <tr>
      <th>2025-10-28</th>
      <td>25.9547</td>
      <td>180.4625</td>
      <td>13.9548</td>
      <td>86.6385</td>
      <td>28.330</td>
      <td>15.4433</td>
      <td>18.2800</td>
      <td>46.9788</td>
      <td>30.7298</td>
      <td>62.9434</td>
      <td>5190.0957</td>
    </tr>
    <tr>
      <th>2025-10-29</th>
      <td>26.6142</td>
      <td>182.7537</td>
      <td>14.0564</td>
      <td>88.0463</td>
      <td>28.755</td>
      <td>15.6010</td>
      <td>18.3470</td>
      <td>47.6764</td>
      <td>29.9032</td>
      <td>61.8176</td>
      <td>5209.8821</td>
    </tr>
    <tr>
      <th>2025-10-30</th>
      <td>26.4350</td>
      <td>177.5869</td>
      <td>13.9991</td>
      <td>87.1968</td>
      <td>28.830</td>
      <td>15.8986</td>
      <td>18.3604</td>
      <td>47.1680</td>
      <td>29.6282</td>
      <td>62.0695</td>
      <td>5186.9079</td>
    </tr>
    <tr>
      <th>2025-10-31</th>
      <td>26.7514</td>
      <td>203.2744</td>
      <td>13.9917</td>
      <td>87.0850</td>
      <td>28.475</td>
      <td>15.5069</td>
      <td>18.1955</td>
      <td>47.3439</td>
      <td>30.0944</td>
      <td>61.9860</td>
      <td>5208.8029</td>
    </tr>
  </tbody>
</table>
<p>237 rows × 11 columns</p>
</div>
</div>
</div>
<div id="returns" class="cell" data-execution_count="3">
<details class="code-fold">
<summary>Show code</summary>
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>returns <span class="op">=</span> (df <span class="op">/</span> df.shift(<span class="dv">1</span>)<span class="op">-</span><span class="dv">1</span>)</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>returns <span class="op">=</span> returns.dropna()</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>SPXreturns <span class="op">=</span> returns[<span class="st">"SPX Index"</span>]</span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>full_returns <span class="op">=</span> returns</span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>returns <span class="op">=</span> returns.iloc[:, :<span class="op">-</span><span class="dv">1</span>] <span class="co"># Exclude SPX for initial analysis</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div id="cell-IQR" class="cell" data-execution_count="4">
<details class="code-fold">
<summary>Show code</summary>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>low <span class="op">=</span> <span class="dv">1</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>high <span class="op">=</span> <span class="dv">100</span> <span class="op">-</span> low</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>q1 <span class="op">=</span> df.quantile(low<span class="op">/</span><span class="dv">100</span>)</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>q3 <span class="op">=</span> df.quantile(high<span class="op">/</span><span class="dv">100</span>)</span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>iqr <span class="op">=</span> q3 <span class="op">-</span> q1</span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>iqr_df <span class="op">=</span> pd.DataFrame({<span class="st">"Q1"</span>: q1, <span class="st">"Q3"</span>: q3, <span class="st">"IQR"</span>: iqr}).<span class="bu">round</span>(<span class="dv">4</span>)</span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>iqr_df_sorted <span class="op">=</span> iqr_df.sort_values(<span class="st">"IQR"</span>, ascending<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Per-asset IQR (sorted):"</span>)</span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a>display(iqr_df_sorted)</span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Overall IQR across all prices (flattened, excluding NaNs)</span></span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true" tabindex="-1"></a>all_vals <span class="op">=</span> df.values.flatten()</span>
<span id="cb5-15"><a href="#cb5-15" aria-hidden="true" tabindex="-1"></a>all_vals <span class="op">=</span> all_vals[<span class="op">~</span>np.isnan(all_vals)]</span>
<span id="cb5-16"><a href="#cb5-16" aria-hidden="true" tabindex="-1"></a>overall_q1 <span class="op">=</span> np.percentile(all_vals, low)</span>
<span id="cb5-17"><a href="#cb5-17" aria-hidden="true" tabindex="-1"></a>overall_q3 <span class="op">=</span> np.percentile(all_vals, high)</span>
<span id="cb5-18"><a href="#cb5-18" aria-hidden="true" tabindex="-1"></a>overall_iqr <span class="op">=</span> overall_q3 <span class="op">-</span> overall_q1</span>
<span id="cb5-19"><a href="#cb5-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-20"><a href="#cb5-20" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"</span><span class="ch">\n</span><span class="ss">Overall IQR across all prices: </span><span class="sc">{</span>overall_iqr<span class="sc">:.4f}</span><span class="ss"> (Q1=</span><span class="sc">{</span>overall_q1<span class="sc">:.4f}</span><span class="ss">, Q3=</span><span class="sc">{</span>overall_q3<span class="sc">:.4f}</span><span class="ss">)"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Per-asset IQR (sorted):</code></pre>
</div>
<div id="iqr" class="cell-output cell-output-display">
<div>

<table class="dataframe table table-sm table-striped small">
  <thead>
    <tr>
      <th></th>
      <th>Q1</th>
      <th>Q3</th>
      <th>IQR</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>SPX Index</th>
      <td>3967.3027</td>
      <td>5188.9481</td>
      <td>1221.6454</td>
    </tr>
    <tr>
      <th>FSLR US Equity</th>
      <td>94.2891</td>
      <td>182.6662</td>
      <td>88.3770</td>
    </tr>
    <tr>
      <th>AMRC US Equity</th>
      <td>7.2517</td>
      <td>31.5746</td>
      <td>24.3229</td>
    </tr>
    <tr>
      <th>XOM US Equity</th>
      <td>76.1976</td>
      <td>95.5678</td>
      <td>19.3702</td>
    </tr>
    <tr>
      <th>NEE US Equity</th>
      <td>49.6777</td>
      <td>63.5304</td>
      <td>13.8527</td>
    </tr>
    <tr>
      <th>CVX US Equity</th>
      <td>20.4389</td>
      <td>27.7993</td>
      <td>7.3604</td>
    </tr>
    <tr>
      <th>TTE FP Equity</th>
      <td>42.7103</td>
      <td>49.8784</td>
      <td>7.1681</td>
    </tr>
    <tr>
      <th>VWS DC Equity</th>
      <td>9.8449</td>
      <td>15.7520</td>
      <td>5.9070</td>
    </tr>
    <tr>
      <th>SHEL LN Equity</th>
      <td>23.3626</td>
      <td>28.4974</td>
      <td>5.1348</td>
    </tr>
    <tr>
      <th>ENI IM Equity</th>
      <td>10.0427</td>
      <td>13.9784</td>
      <td>3.9357</td>
    </tr>
    <tr>
      <th>EQNR NO Equity</th>
      <td>17.1192</td>
      <td>20.9715</td>
      <td>3.8523</td>
    </tr>
  </tbody>
</table>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
Overall IQR across all prices: 4936.8316 (Q1=8.6100, Q3=4945.4416)</code></pre>
</div>
</div>
<div id="cell-abs_change" class="cell" data-execution_count="5">
<details class="code-fold">
<summary>Show code</summary>
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>last_prices <span class="op">=</span> df.iloc[<span class="op">-</span><span class="dv">1</span>]</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>first_prices <span class="op">=</span> df.iloc[<span class="dv">0</span>]</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>pd.DataFrame({ <span class="st">"first_prices"</span>:first_prices, <span class="st">"last_prices"</span>:last_prices,<span class="st">"Change"</span>:(last_prices<span class="op">-</span>first_prices)})</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div id="abs_change" class="cell-output cell-output-display" data-execution_count="5">
<div>

<table class="dataframe table table-sm table-striped small">
  <thead>
    <tr>
      <th></th>
      <th>first_prices</th>
      <th>last_prices</th>
      <th>Change</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>CVX US Equity</th>
      <td>22.609839</td>
      <td>26.751447</td>
      <td>4.141608</td>
    </tr>
    <tr>
      <th>FSLR US Equity</th>
      <td>158.524134</td>
      <td>203.274444</td>
      <td>44.750310</td>
    </tr>
    <tr>
      <th>ENI IM Equity</th>
      <td>11.763028</td>
      <td>13.991673</td>
      <td>2.228646</td>
    </tr>
    <tr>
      <th>XOM US Equity</th>
      <td>88.915532</td>
      <td>87.084983</td>
      <td>-1.830549</td>
    </tr>
    <tr>
      <th>SHEL LN Equity</th>
      <td>25.790000</td>
      <td>28.475000</td>
      <td>2.685000</td>
    </tr>
    <tr>
      <th>VWS DC Equity</th>
      <td>14.906621</td>
      <td>15.506851</td>
      <td>0.600230</td>
    </tr>
    <tr>
      <th>EQNR NO Equity</th>
      <td>18.123787</td>
      <td>18.195546</td>
      <td>0.071758</td>
    </tr>
    <tr>
      <th>TTE FP Equity</th>
      <td>48.530662</td>
      <td>47.343878</td>
      <td>-1.186785</td>
    </tr>
    <tr>
      <th>AMRC US Equity</th>
      <td>25.007735</td>
      <td>30.094426</td>
      <td>5.086691</td>
    </tr>
    <tr>
      <th>NEE US Equity</th>
      <td>59.831374</td>
      <td>61.985988</td>
      <td>2.154615</td>
    </tr>
    <tr>
      <th>SPX Index</th>
      <td>4431.311881</td>
      <td>5208.802924</td>
      <td>777.491043</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
<div id="cell-total_return" class="cell" data-execution_count="6">
<details class="code-fold">
<summary>Show code</summary>
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>returns.<span class="bu">sum</span>().sort_values(ascending<span class="op">=</span><span class="va">False</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div id="total_return" class="cell-output cell-output-display" data-execution_count="6">
<pre><code>AMRC US Equity    0.634550
FSLR US Equity    0.445022
CVX US Equity     0.210595
VWS DC Equity     0.194381
ENI IM Equity     0.193326
SHEL LN Equity    0.119714
NEE US Equity     0.073968
EQNR NO Equity    0.053911
XOM US Equity     0.010326
TTE FP Equity    -0.003804
dtype: float64</code></pre>
</div>
</div>
<p>days with the highest returns</p>
<p>::: {#cell-Largest Daily Move .cell execution_count=7}</p>
<details class="code-fold">
<summary>Show code</summary>
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>DAYS <span class="op">=</span> pd.DataFrame({<span class="st">"Name"</span>:returns.columns, <span class="st">"Negative"</span>:returns.idxmin(axis<span class="op">=</span><span class="dv">0</span>), <span class="st">"Positive"</span>:returns.idxmax(axis<span class="op">=</span><span class="dv">0</span>), </span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a><span class="co">#"Difference": returns.idxmax(axis=0)-returns.idxmin(axis=0)</span></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>(</span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>    GT(DAYS)</span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>    .tab_header(title<span class="op">=</span><span class="st">"Date of Largest Daily Move"</span>)</span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>    .opt_stylize(<span class="dv">5</span>, color <span class="op">=</span> <span class="st">"gray"</span>)</span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div id="largest-daily-move" class="cell-output cell-output-display" data-execution_count="7">
<div id="tcgynbjrbe" style="padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>
#tcgynbjrbe table {
          font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Helvetica Neue', 'Fira Sans', 'Droid Sans', Arial, sans-serif;
          -webkit-font-smoothing: antialiased;
          -moz-osx-font-smoothing: grayscale;
        }

#tcgynbjrbe thead, tbody, tfoot, tr, td, th { border-style: none; }
 tr { background-color: transparent; }
#tcgynbjrbe p { margin: 0; padding: 0; }
 #tcgynbjrbe .gt_table { display: table; border-collapse: collapse; line-height: normal; margin-left: auto; margin-right: auto; color: #333333; font-size: 16px; font-weight: normal; font-style: normal; background-color: #FFFFFF; width: auto; border-top-style: solid; border-top-width: 3px; border-top-color: #D5D5D5; border-right-style: solid; border-right-width: 3px; border-right-color: #D5D5D5; border-bottom-style: solid; border-bottom-width: 3px; border-bottom-color: #D5D5D5; border-left-style: solid; border-left-width: 3px; border-left-color: #D5D5D5; }
 #tcgynbjrbe .gt_caption { padding-top: 4px; padding-bottom: 4px; }
 #tcgynbjrbe .gt_title { color: #333333; font-size: 125%; font-weight: initial; padding-top: 4px; padding-bottom: 4px; padding-left: 5px; padding-right: 5px; border-bottom-color: #FFFFFF; border-bottom-width: 0; }
 #tcgynbjrbe .gt_subtitle { color: #333333; font-size: 85%; font-weight: initial; padding-top: 3px; padding-bottom: 5px; padding-left: 5px; padding-right: 5px; border-top-color: #FFFFFF; border-top-width: 0; }
 #tcgynbjrbe .gt_heading { background-color: #FFFFFF; text-align: center; border-bottom-color: #FFFFFF; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; }
 #tcgynbjrbe .gt_bottom_border { border-bottom-style: solid; border-bottom-width: 2px; border-bottom-color: #D5D5D5; }
 #tcgynbjrbe .gt_col_headings { border-top-style: solid; border-top-width: 2px; border-top-color: #D5D5D5; border-bottom-style: solid; border-bottom-width: 2px; border-bottom-color: #D5D5D5; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; }
 #tcgynbjrbe .gt_col_heading { color: #FFFFFF; background-color: #000000; font-size: 100%; font-weight: normal; text-transform: inherit; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; vertical-align: bottom; padding-top: 5px; padding-bottom: 5px; padding-left: 5px; padding-right: 5px; overflow-x: hidden; }
 #tcgynbjrbe .gt_column_spanner_outer { color: #FFFFFF; background-color: #000000; font-size: 100%; font-weight: normal; text-transform: inherit; padding-top: 0; padding-bottom: 0; padding-left: 4px; padding-right: 4px; }
 #tcgynbjrbe .gt_column_spanner_outer:first-child { padding-left: 0; }
 #tcgynbjrbe .gt_column_spanner_outer:last-child { padding-right: 0; }
 #tcgynbjrbe .gt_column_spanner { border-bottom-style: solid; border-bottom-width: 2px; border-bottom-color: #D5D5D5; vertical-align: bottom; padding-top: 5px; padding-bottom: 5px; overflow-x: hidden; display: inline-block; width: 100%; }
 #tcgynbjrbe .gt_spanner_row { border-bottom-style: hidden; }
 #tcgynbjrbe .gt_group_heading { padding-top: 8px; padding-bottom: 8px; padding-left: 5px; padding-right: 5px; color: #333333; background-color: #FFFFFF; font-size: 100%; font-weight: initial; text-transform: inherit; border-top-style: solid; border-top-width: 2px; border-top-color: #D5D5D5; border-bottom-style: solid; border-bottom-width: 2px; border-bottom-color: #D5D5D5; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; vertical-align: middle; text-align: left; }
 #tcgynbjrbe .gt_empty_group_heading { padding: 0.5px; color: #333333; background-color: #FFFFFF; font-size: 100%; font-weight: initial; border-top-style: solid; border-top-width: 2px; border-top-color: #D5D5D5; border-bottom-style: solid; border-bottom-width: 2px; border-bottom-color: #D5D5D5; vertical-align: middle; }
 #tcgynbjrbe .gt_from_md> :first-child { margin-top: 0; }
 #tcgynbjrbe .gt_from_md> :last-child { margin-bottom: 0; }
 #tcgynbjrbe .gt_row { padding-top: 8px; padding-bottom: 8px; padding-left: 5px; padding-right: 5px; margin: 10px; border-top-style: solid; border-top-width: 1px; border-top-color: #D5D5D5; border-left-style: solid; border-left-width: 1px; border-left-color: #D5D5D5; border-right-style: solid; border-right-width: 1px; border-right-color: #D5D5D5; vertical-align: middle; overflow-x: hidden; }
 #tcgynbjrbe .gt_stub { color: #333333; background-color: #929292; font-size: 100%; font-weight: initial; text-transform: inherit; border-right-style: solid; border-right-width: 2px; border-right-color: #D5D5D5; padding-left: 5px; padding-right: 5px; }
 #tcgynbjrbe .gt_stub_row_group { color: #333333; background-color: #FFFFFF; font-size: 100%; font-weight: initial; text-transform: inherit; border-right-style: solid; border-right-width: 2px; border-right-color: #D3D3D3; padding-left: 5px; padding-right: 5px; vertical-align: top; }
 #tcgynbjrbe .gt_row_group_first td { border-top-width: 2px; }
 #tcgynbjrbe .gt_row_group_first th { border-top-width: 2px; }
 #tcgynbjrbe .gt_striped { color: #333333; background-color: #F4F4F4; }
 #tcgynbjrbe .gt_table_body { border-top-style: solid; border-top-width: 2px; border-top-color: #D5D5D5; border-bottom-style: solid; border-bottom-width: 2px; border-bottom-color: #D5D5D5; }
 #tcgynbjrbe .gt_sourcenotes { color: #333333; background-color: #FFFFFF; border-bottom-style: none; border-bottom-width: 2px; border-bottom-color: #D3D3D3; border-left-style: none; border-left-width: 2px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 2px; border-right-color: #D3D3D3; }
 #tcgynbjrbe .gt_sourcenote { font-size: 90%; padding-top: 4px; padding-bottom: 4px; padding-left: 5px; padding-right: 5px; text-align: left; }
 #tcgynbjrbe .gt_left { text-align: left; }
 #tcgynbjrbe .gt_center { text-align: center; }
 #tcgynbjrbe .gt_right { text-align: right; font-variant-numeric: tabular-nums; }
 #tcgynbjrbe .gt_font_normal { font-weight: normal; }
 #tcgynbjrbe .gt_font_bold { font-weight: bold; }
 #tcgynbjrbe .gt_font_italic { font-style: italic; }
 #tcgynbjrbe .gt_super { font-size: 65%; }
 #tcgynbjrbe .gt_footnote_marks { font-size: 75%; vertical-align: 0.4em; position: initial; }
 #tcgynbjrbe .gt_asterisk { font-size: 100%; vertical-align: 0; }
 
</style>
<table class="gt_table" data-quarto-disable-processing="false" data-quarto-bootstrap="false">
<thead>

  <tr class="gt_heading">
    <td colspan="3" class="gt_heading gt_title gt_font_normal">Date of Largest Daily Move</td>
  </tr>
<tr class="gt_col_headings">
  <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1" scope="col" id="Name">Name</th>
  <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1" scope="col" id="Negative">Negative</th>
  <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1" scope="col" id="Positive">Positive</th>
</tr>
</thead>
<tbody class="gt_table_body">
  <tr>
    <td class="gt_row gt_left">CVX US Equity</td>
    <td class="gt_row gt_right">2025-04-03</td>
    <td class="gt_row gt_right">2025-04-09</td>
  </tr>
  <tr>
    <td class="gt_row gt_left gt_striped">FSLR US Equity</td>
    <td class="gt_row gt_right gt_striped">2025-06-17</td>
    <td class="gt_row gt_right gt_striped">2025-08-18</td>
  </tr>
  <tr>
    <td class="gt_row gt_left">ENI IM Equity</td>
    <td class="gt_row gt_right">2025-04-07</td>
    <td class="gt_row gt_right">2025-10-23</td>
  </tr>
  <tr>
    <td class="gt_row gt_left gt_striped">XOM US Equity</td>
    <td class="gt_row gt_right gt_striped">2025-04-10</td>
    <td class="gt_row gt_right gt_striped">2025-04-09</td>
  </tr>
  <tr>
    <td class="gt_row gt_left">SHEL LN Equity</td>
    <td class="gt_row gt_right">2025-04-04</td>
    <td class="gt_row gt_right">2025-06-10</td>
  </tr>
  <tr>
    <td class="gt_row gt_left gt_striped">VWS DC Equity</td>
    <td class="gt_row gt_right gt_striped">2024-11-06</td>
    <td class="gt_row gt_right gt_striped">2025-08-18</td>
  </tr>
  <tr>
    <td class="gt_row gt_left">EQNR NO Equity</td>
    <td class="gt_row gt_right">2025-06-24</td>
    <td class="gt_row gt_right">2025-01-02</td>
  </tr>
  <tr>
    <td class="gt_row gt_left gt_striped">TTE FP Equity</td>
    <td class="gt_row gt_right gt_striped">2025-04-04</td>
    <td class="gt_row gt_right gt_striped">2025-10-15</td>
  </tr>
  <tr>
    <td class="gt_row gt_left">AMRC US Equity</td>
    <td class="gt_row gt_right">2025-02-28</td>
    <td class="gt_row gt_right">2025-08-05</td>
  </tr>
  <tr>
    <td class="gt_row gt_left gt_striped">NEE US Equity</td>
    <td class="gt_row gt_right gt_striped">2025-07-23</td>
    <td class="gt_row gt_right gt_striped">2025-04-09</td>
  </tr>
</tbody>


</table>

</div>
        
</div>
<p>:::</p>
<section id="descriptive-statistics-table" class="level2 page-columns page-full">
<h2 class="anchored" data-anchor-id="descriptive-statistics-table">Descriptive statistics table</h2>
<div id="cell-desc_stats" class="cell page-columns page-full" data-execution_count="8">
<details class="code-fold">
<summary>Show code</summary>
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> scipy.stats <span class="im">import</span> norm</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>desc_stats <span class="op">=</span> pd.DataFrame({</span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Count"</span>: returns.count(),</span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Mean"</span>: returns.mean(),</span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Std"</span>: returns.std(),</span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>    <span class="st">"CV"</span>: returns.std()<span class="op">/</span>returns.mean(),</span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Skewness"</span>: returns.skew(),</span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a>    <span class="st">"Kurtosis"</span>: returns.kurt()</span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-13"><a href="#cb12-13" aria-hidden="true" tabindex="-1"></a>index_returns <span class="op">=</span> np.array(SPXreturns)</span>
<span id="cb12-14"><a href="#cb12-14" aria-hidden="true" tabindex="-1"></a>OLS_returns <span class="op">=</span> returns.reset_index()</span>
<span id="cb12-15"><a href="#cb12-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-16"><a href="#cb12-16" aria-hidden="true" tabindex="-1"></a>betas <span class="op">=</span> {}</span>
<span id="cb12-17"><a href="#cb12-17" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> ticker <span class="kw">in</span> OLS_returns.columns[<span class="dv">1</span>:]:</span>
<span id="cb12-18"><a href="#cb12-18" aria-hidden="true" tabindex="-1"></a>    y <span class="op">=</span> OLS_returns[ticker]</span>
<span id="cb12-19"><a href="#cb12-19" aria-hidden="true" tabindex="-1"></a>    X <span class="op">=</span> np.array(add_constant(index_returns))</span>
<span id="cb12-20"><a href="#cb12-20" aria-hidden="true" tabindex="-1"></a>    model <span class="op">=</span> OLS(y, X).fit()</span>
<span id="cb12-21"><a href="#cb12-21" aria-hidden="true" tabindex="-1"></a>    betas[ticker] <span class="op">=</span> model.params[<span class="dv">1</span>]  <span class="co"># beta coefficient</span></span>
<span id="cb12-22"><a href="#cb12-22" aria-hidden="true" tabindex="-1"></a>beta_df <span class="op">=</span> pd.DataFrame.from_dict(betas, orient<span class="op">=</span><span class="st">'index'</span>, columns<span class="op">=</span>[<span class="st">'Beta'</span>])</span>
<span id="cb12-23"><a href="#cb12-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-24"><a href="#cb12-24" aria-hidden="true" tabindex="-1"></a>ADF_test <span class="op">=</span> {}</span>
<span id="cb12-25"><a href="#cb12-25" aria-hidden="true" tabindex="-1"></a>ADF_pval <span class="op">=</span> {}</span>
<span id="cb12-26"><a href="#cb12-26" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> ticker <span class="kw">in</span> OLS_returns.columns[<span class="dv">1</span>:]:</span>
<span id="cb12-27"><a href="#cb12-27" aria-hidden="true" tabindex="-1"></a>    model <span class="op">=</span> adfuller(OLS_returns[ticker])</span>
<span id="cb12-28"><a href="#cb12-28" aria-hidden="true" tabindex="-1"></a>    ADF_test[ticker] <span class="op">=</span> model[<span class="dv">0</span>]  <span class="co"># ADF coefficient</span></span>
<span id="cb12-29"><a href="#cb12-29" aria-hidden="true" tabindex="-1"></a>    ADF_pval[ticker] <span class="op">=</span> model[<span class="dv">1</span>]  <span class="co"># pval </span></span>
<span id="cb12-30"><a href="#cb12-30" aria-hidden="true" tabindex="-1"></a>ADF_test_df <span class="op">=</span> pd.DataFrame.from_dict(ADF_test, orient<span class="op">=</span><span class="st">'index'</span>)</span>
<span id="cb12-31"><a href="#cb12-31" aria-hidden="true" tabindex="-1"></a>ADF_pval_df <span class="op">=</span> pd.DataFrame.from_dict(ADF_pval, orient<span class="op">=</span><span class="st">'index'</span>)</span>
<span id="cb12-32"><a href="#cb12-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-33"><a href="#cb12-33" aria-hidden="true" tabindex="-1"></a>JB_test <span class="op">=</span> {}</span>
<span id="cb12-34"><a href="#cb12-34" aria-hidden="true" tabindex="-1"></a>JB_pval <span class="op">=</span> {}</span>
<span id="cb12-35"><a href="#cb12-35" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> ticker <span class="kw">in</span> OLS_returns.columns[<span class="dv">1</span>:]:</span>
<span id="cb12-36"><a href="#cb12-36" aria-hidden="true" tabindex="-1"></a>    model <span class="op">=</span> jarque_bera(OLS_returns[ticker])</span>
<span id="cb12-37"><a href="#cb12-37" aria-hidden="true" tabindex="-1"></a>    JB_test[ticker] <span class="op">=</span> model[<span class="dv">0</span>]  <span class="co"># ADF coefficient</span></span>
<span id="cb12-38"><a href="#cb12-38" aria-hidden="true" tabindex="-1"></a>    JB_pval[ticker] <span class="op">=</span> model[<span class="dv">1</span>]  <span class="co"># pval </span></span>
<span id="cb12-39"><a href="#cb12-39" aria-hidden="true" tabindex="-1"></a>JB_test_df <span class="op">=</span> pd.DataFrame.from_dict(JB_test, orient<span class="op">=</span><span class="st">'index'</span>)</span>
<span id="cb12-40"><a href="#cb12-40" aria-hidden="true" tabindex="-1"></a>JB_pval_df <span class="op">=</span> pd.DataFrame.from_dict(JB_pval, orient<span class="op">=</span><span class="st">'index'</span>)</span>
<span id="cb12-41"><a href="#cb12-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-42"><a href="#cb12-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-43"><a href="#cb12-43" aria-hidden="true" tabindex="-1"></a><span class="co"># VAR 5%</span></span>
<span id="cb12-44"><a href="#cb12-44" aria-hidden="true" tabindex="-1"></a>VAR5 <span class="op">=</span> {}</span>
<span id="cb12-45"><a href="#cb12-45" aria-hidden="true" tabindex="-1"></a>VAR1 <span class="op">=</span> {}</span>
<span id="cb12-46"><a href="#cb12-46" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> ticker <span class="kw">in</span> OLS_returns.columns[<span class="dv">1</span>:]:</span>
<span id="cb12-47"><a href="#cb12-47" aria-hidden="true" tabindex="-1"></a>    VAR5[ticker] <span class="op">=</span> norm.ppf(<span class="fl">0.05</span>, loc<span class="op">=</span>desc_stats[<span class="st">"Mean"</span>][ticker], scale<span class="op">=</span>desc_stats[<span class="st">"Std"</span>][ticker])</span>
<span id="cb12-48"><a href="#cb12-48" aria-hidden="true" tabindex="-1"></a>    VAR1[ticker] <span class="op">=</span> norm.ppf(<span class="fl">0.01</span>, loc<span class="op">=</span>desc_stats[<span class="st">"Mean"</span>][ticker], scale<span class="op">=</span>desc_stats[<span class="st">"Std"</span>][ticker])</span>
<span id="cb12-49"><a href="#cb12-49" aria-hidden="true" tabindex="-1"></a>VAR5_df <span class="op">=</span> pd.DataFrame.from_dict(VAR5, orient<span class="op">=</span><span class="st">'index'</span>)</span>
<span id="cb12-50"><a href="#cb12-50" aria-hidden="true" tabindex="-1"></a>VAR1_df <span class="op">=</span> pd.DataFrame.from_dict(VAR1, orient<span class="op">=</span><span class="st">'index'</span>)</span>
<span id="cb12-51"><a href="#cb12-51" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-52"><a href="#cb12-52" aria-hidden="true" tabindex="-1"></a>desc_stats[<span class="st">'CV'</span>] <span class="op">=</span> desc_stats[<span class="st">"Std"</span>]<span class="op">/</span>desc_stats[<span class="st">"Mean"</span>]</span>
<span id="cb12-53"><a href="#cb12-53" aria-hidden="true" tabindex="-1"></a>desc_stats[<span class="st">'Beta'</span>] <span class="op">=</span> beta_df</span>
<span id="cb12-54"><a href="#cb12-54" aria-hidden="true" tabindex="-1"></a><span class="co"># desc_stats['ADF test'] = ADF_test_df </span></span>
<span id="cb12-55"><a href="#cb12-55" aria-hidden="true" tabindex="-1"></a><span class="co"># desc_stats['ADF p-value'] = ADF_pval_df</span></span>
<span id="cb12-56"><a href="#cb12-56" aria-hidden="true" tabindex="-1"></a><span class="co"># desc_stats['JB test'] = JB_test_df</span></span>
<span id="cb12-57"><a href="#cb12-57" aria-hidden="true" tabindex="-1"></a><span class="co"># desc_stats['JB p-value'] = JB_pval_df</span></span>
<span id="cb12-58"><a href="#cb12-58" aria-hidden="true" tabindex="-1"></a>desc_stats[<span class="st">'VAR 5%'</span>] <span class="op">=</span> VAR5_df</span>
<span id="cb12-59"><a href="#cb12-59" aria-hidden="true" tabindex="-1"></a>desc_stats[<span class="st">'VAR 1%'</span>] <span class="op">=</span> VAR1_df</span>
<span id="cb12-60"><a href="#cb12-60" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-61"><a href="#cb12-61" aria-hidden="true" tabindex="-1"></a><span class="co"># desc_stats = desc_stats.round(5)</span></span>
<span id="cb12-62"><a href="#cb12-62" aria-hidden="true" tabindex="-1"></a>desc_stats[<span class="st">'Name'</span>] <span class="op">=</span> returns.columns</span>
<span id="cb12-63"><a href="#cb12-63" aria-hidden="true" tabindex="-1"></a><span class="co"># cols_to_select = desc_stats.columns.drop("Name")</span></span>
<span id="cb12-64"><a href="#cb12-64" aria-hidden="true" tabindex="-1"></a>(</span>
<span id="cb12-65"><a href="#cb12-65" aria-hidden="true" tabindex="-1"></a>    GT(desc_stats).cols_move_to_start(columns<span class="op">=</span><span class="st">"Name"</span>)</span>
<span id="cb12-66"><a href="#cb12-66" aria-hidden="true" tabindex="-1"></a>    .tab_header(title<span class="op">=</span><span class="st">"Descriptive Statistics for selected companies"</span>, </span>
<span id="cb12-67"><a href="#cb12-67" aria-hidden="true" tabindex="-1"></a>    <span class="co">#    subtitle="S&amp;P 500 used as refernence index"</span></span>
<span id="cb12-68"><a href="#cb12-68" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb12-69"><a href="#cb12-69" aria-hidden="true" tabindex="-1"></a>    .opt_stylize(<span class="dv">5</span>, color <span class="op">=</span> <span class="st">"gray"</span>)</span>
<span id="cb12-70"><a href="#cb12-70" aria-hidden="true" tabindex="-1"></a>    .fmt(<span class="kw">lambda</span> x: <span class="ss">f"</span><span class="sc">{</span>x<span class="sc">:.2e}</span><span class="ss">"</span>, columns<span class="op">=</span>[<span class="st">"Mean"</span>, <span class="st">"Std"</span>, </span>
<span id="cb12-71"><a href="#cb12-71" aria-hidden="true" tabindex="-1"></a>    <span class="co"># "ADF p-value", "JB p-value"</span></span>
<span id="cb12-72"><a href="#cb12-72" aria-hidden="true" tabindex="-1"></a>    ])</span>
<span id="cb12-73"><a href="#cb12-73" aria-hidden="true" tabindex="-1"></a>    .fmt(<span class="kw">lambda</span> x: <span class="ss">f"</span><span class="sc">{</span>x<span class="sc">:.4f}</span><span class="ss">"</span>, columns<span class="op">=</span>[<span class="st">"Skewness"</span>,<span class="st">"Kurtosis"</span>, <span class="st">"CV"</span>, <span class="st">"Beta"</span>, </span>
<span id="cb12-74"><a href="#cb12-74" aria-hidden="true" tabindex="-1"></a>    <span class="co"># "ADF test"</span></span>
<span id="cb12-75"><a href="#cb12-75" aria-hidden="true" tabindex="-1"></a>    ])</span>
<span id="cb12-76"><a href="#cb12-76" aria-hidden="true" tabindex="-1"></a>    .fmt(<span class="kw">lambda</span> x: <span class="ss">f"</span><span class="sc">{</span>x<span class="sc">:.4%}</span><span class="ss">"</span>, columns<span class="op">=</span>[<span class="st">'VAR 5%'</span>, <span class="st">'VAR 1%'</span>])</span>
<span id="cb12-77"><a href="#cb12-77" aria-hidden="true" tabindex="-1"></a>    .fmt_integer(columns <span class="op">=</span> <span class="st">"Count"</span>)</span>
<span id="cb12-78"><a href="#cb12-78" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-79"><a href="#cb12-79" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-80"><a href="#cb12-80" aria-hidden="true" tabindex="-1"></a>    <span class="co"># .fmt(lambda x: f"{x:.2f}", columns=["JB test"])</span></span>
<span id="cb12-81"><a href="#cb12-81" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-82"><a href="#cb12-82" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div id="desc_stats" class="cell-output cell-output-display column-screen" data-execution_count="8">
<div id="opyeptwbme" style="padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>
#opyeptwbme table {
          font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Helvetica Neue', 'Fira Sans', 'Droid Sans', Arial, sans-serif;
          -webkit-font-smoothing: antialiased;
          -moz-osx-font-smoothing: grayscale;
        }

#opyeptwbme thead, tbody, tfoot, tr, td, th { border-style: none; }
 tr { background-color: transparent; }
#opyeptwbme p { margin: 0; padding: 0; }
 #opyeptwbme .gt_table { display: table; border-collapse: collapse; line-height: normal; margin-left: auto; margin-right: auto; color: #333333; font-size: 16px; font-weight: normal; font-style: normal; background-color: #FFFFFF; width: auto; border-top-style: solid; border-top-width: 3px; border-top-color: #D5D5D5; border-right-style: solid; border-right-width: 3px; border-right-color: #D5D5D5; border-bottom-style: solid; border-bottom-width: 3px; border-bottom-color: #D5D5D5; border-left-style: solid; border-left-width: 3px; border-left-color: #D5D5D5; }
 #opyeptwbme .gt_caption { padding-top: 4px; padding-bottom: 4px; }
 #opyeptwbme .gt_title { color: #333333; font-size: 125%; font-weight: initial; padding-top: 4px; padding-bottom: 4px; padding-left: 5px; padding-right: 5px; border-bottom-color: #FFFFFF; border-bottom-width: 0; }
 #opyeptwbme .gt_subtitle { color: #333333; font-size: 85%; font-weight: initial; padding-top: 3px; padding-bottom: 5px; padding-left: 5px; padding-right: 5px; border-top-color: #FFFFFF; border-top-width: 0; }
 #opyeptwbme .gt_heading { background-color: #FFFFFF; text-align: center; border-bottom-color: #FFFFFF; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; }
 #opyeptwbme .gt_bottom_border { border-bottom-style: solid; border-bottom-width: 2px; border-bottom-color: #D5D5D5; }
 #opyeptwbme .gt_col_headings { border-top-style: solid; border-top-width: 2px; border-top-color: #D5D5D5; border-bottom-style: solid; border-bottom-width: 2px; border-bottom-color: #D5D5D5; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; }
 #opyeptwbme .gt_col_heading { color: #FFFFFF; background-color: #000000; font-size: 100%; font-weight: normal; text-transform: inherit; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; vertical-align: bottom; padding-top: 5px; padding-bottom: 5px; padding-left: 5px; padding-right: 5px; overflow-x: hidden; }
 #opyeptwbme .gt_column_spanner_outer { color: #FFFFFF; background-color: #000000; font-size: 100%; font-weight: normal; text-transform: inherit; padding-top: 0; padding-bottom: 0; padding-left: 4px; padding-right: 4px; }
 #opyeptwbme .gt_column_spanner_outer:first-child { padding-left: 0; }
 #opyeptwbme .gt_column_spanner_outer:last-child { padding-right: 0; }
 #opyeptwbme .gt_column_spanner { border-bottom-style: solid; border-bottom-width: 2px; border-bottom-color: #D5D5D5; vertical-align: bottom; padding-top: 5px; padding-bottom: 5px; overflow-x: hidden; display: inline-block; width: 100%; }
 #opyeptwbme .gt_spanner_row { border-bottom-style: hidden; }
 #opyeptwbme .gt_group_heading { padding-top: 8px; padding-bottom: 8px; padding-left: 5px; padding-right: 5px; color: #333333; background-color: #FFFFFF; font-size: 100%; font-weight: initial; text-transform: inherit; border-top-style: solid; border-top-width: 2px; border-top-color: #D5D5D5; border-bottom-style: solid; border-bottom-width: 2px; border-bottom-color: #D5D5D5; border-left-style: none; border-left-width: 1px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 1px; border-right-color: #D3D3D3; vertical-align: middle; text-align: left; }
 #opyeptwbme .gt_empty_group_heading { padding: 0.5px; color: #333333; background-color: #FFFFFF; font-size: 100%; font-weight: initial; border-top-style: solid; border-top-width: 2px; border-top-color: #D5D5D5; border-bottom-style: solid; border-bottom-width: 2px; border-bottom-color: #D5D5D5; vertical-align: middle; }
 #opyeptwbme .gt_from_md> :first-child { margin-top: 0; }
 #opyeptwbme .gt_from_md> :last-child { margin-bottom: 0; }
 #opyeptwbme .gt_row { padding-top: 8px; padding-bottom: 8px; padding-left: 5px; padding-right: 5px; margin: 10px; border-top-style: solid; border-top-width: 1px; border-top-color: #D5D5D5; border-left-style: solid; border-left-width: 1px; border-left-color: #D5D5D5; border-right-style: solid; border-right-width: 1px; border-right-color: #D5D5D5; vertical-align: middle; overflow-x: hidden; }
 #opyeptwbme .gt_stub { color: #333333; background-color: #929292; font-size: 100%; font-weight: initial; text-transform: inherit; border-right-style: solid; border-right-width: 2px; border-right-color: #D5D5D5; padding-left: 5px; padding-right: 5px; }
 #opyeptwbme .gt_stub_row_group { color: #333333; background-color: #FFFFFF; font-size: 100%; font-weight: initial; text-transform: inherit; border-right-style: solid; border-right-width: 2px; border-right-color: #D3D3D3; padding-left: 5px; padding-right: 5px; vertical-align: top; }
 #opyeptwbme .gt_row_group_first td { border-top-width: 2px; }
 #opyeptwbme .gt_row_group_first th { border-top-width: 2px; }
 #opyeptwbme .gt_striped { color: #333333; background-color: #F4F4F4; }
 #opyeptwbme .gt_table_body { border-top-style: solid; border-top-width: 2px; border-top-color: #D5D5D5; border-bottom-style: solid; border-bottom-width: 2px; border-bottom-color: #D5D5D5; }
 #opyeptwbme .gt_sourcenotes { color: #333333; background-color: #FFFFFF; border-bottom-style: none; border-bottom-width: 2px; border-bottom-color: #D3D3D3; border-left-style: none; border-left-width: 2px; border-left-color: #D3D3D3; border-right-style: none; border-right-width: 2px; border-right-color: #D3D3D3; }
 #opyeptwbme .gt_sourcenote { font-size: 90%; padding-top: 4px; padding-bottom: 4px; padding-left: 5px; padding-right: 5px; text-align: left; }
 #opyeptwbme .gt_left { text-align: left; }
 #opyeptwbme .gt_center { text-align: center; }
 #opyeptwbme .gt_right { text-align: right; font-variant-numeric: tabular-nums; }
 #opyeptwbme .gt_font_normal { font-weight: normal; }
 #opyeptwbme .gt_font_bold { font-weight: bold; }
 #opyeptwbme .gt_font_italic { font-style: italic; }
 #opyeptwbme .gt_super { font-size: 65%; }
 #opyeptwbme .gt_footnote_marks { font-size: 75%; vertical-align: 0.4em; position: initial; }
 #opyeptwbme .gt_asterisk { font-size: 100%; vertical-align: 0; }
 
</style>
<table class="gt_table" data-quarto-disable-processing="false" data-quarto-bootstrap="false">
<thead>

  <tr class="gt_heading">
    <td colspan="10" class="gt_heading gt_title gt_font_normal">Descriptive Statistics for selected companies</td>
  </tr>
<tr class="gt_col_headings">
  <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1" scope="col" id="Name">Name</th>
  <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1" scope="col" id="Count">Count</th>
  <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1" scope="col" id="Mean">Mean</th>
  <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1" scope="col" id="Std">Std</th>
  <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1" scope="col" id="CV">CV</th>
  <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1" scope="col" id="Skewness">Skewness</th>
  <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1" scope="col" id="Kurtosis">Kurtosis</th>
  <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1" scope="col" id="Beta">Beta</th>
  <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1" scope="col" id="VAR-5%">VAR 5%</th>
  <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1" scope="col" id="VAR-1%">VAR 1%</th>
</tr>
</thead>
<tbody class="gt_table_body">
  <tr>
    <td class="gt_row gt_left">CVX US Equity</td>
    <td class="gt_row gt_right">236</td>
    <td class="gt_row gt_right">8.92e-04</td>
    <td class="gt_row gt_right">1.89e-02</td>
    <td class="gt_row gt_right">21.1958</td>
    <td class="gt_row gt_right">-0.5396</td>
    <td class="gt_row gt_right">4.2367</td>
    <td class="gt_row gt_right">0.6900</td>
    <td class="gt_row gt_right">-3.0219%</td>
    <td class="gt_row gt_right">-4.3108%</td>
  </tr>
  <tr>
    <td class="gt_row gt_left gt_striped">FSLR US Equity</td>
    <td class="gt_row gt_right gt_striped">236</td>
    <td class="gt_row gt_right gt_striped">1.89e-03</td>
    <td class="gt_row gt_right gt_striped">4.14e-02</td>
    <td class="gt_row gt_right gt_striped">21.9423</td>
    <td class="gt_row gt_right gt_striped">1.0953</td>
    <td class="gt_row gt_right gt_striped">7.0162</td>
    <td class="gt_row gt_right gt_striped">0.6614</td>
    <td class="gt_row gt_right gt_striped">-6.6172%</td>
    <td class="gt_row gt_right gt_striped">-9.4370%</td>
  </tr>
  <tr>
    <td class="gt_row gt_left">ENI IM Equity</td>
    <td class="gt_row gt_right">236</td>
    <td class="gt_row gt_right">8.19e-04</td>
    <td class="gt_row gt_right">1.29e-02</td>
    <td class="gt_row gt_right">15.7609</td>
    <td class="gt_row gt_right">-1.0759</td>
    <td class="gt_row gt_right">4.3374</td>
    <td class="gt_row gt_right">0.0197</td>
    <td class="gt_row gt_right">-2.0417%</td>
    <td class="gt_row gt_right">-2.9216%</td>
  </tr>
  <tr>
    <td class="gt_row gt_left gt_striped">XOM US Equity</td>
    <td class="gt_row gt_right gt_striped">236</td>
    <td class="gt_row gt_right gt_striped">4.38e-05</td>
    <td class="gt_row gt_right gt_striped">1.62e-02</td>
    <td class="gt_row gt_right gt_striped">370.2611</td>
    <td class="gt_row gt_right gt_striped">-0.8161</td>
    <td class="gt_row gt_right gt_striped">2.4833</td>
    <td class="gt_row gt_right gt_striped">0.6391</td>
    <td class="gt_row gt_right gt_striped">-2.6604%</td>
    <td class="gt_row gt_right gt_striped">-3.7644%</td>
  </tr>
  <tr>
    <td class="gt_row gt_left">SHEL LN Equity</td>
    <td class="gt_row gt_right">236</td>
    <td class="gt_row gt_right">5.07e-04</td>
    <td class="gt_row gt_right">1.32e-02</td>
    <td class="gt_row gt_right">26.0120</td>
    <td class="gt_row gt_right">-1.0894</td>
    <td class="gt_row gt_right">4.0888</td>
    <td class="gt_row gt_right">0.1022</td>
    <td class="gt_row gt_right">-2.1196%</td>
    <td class="gt_row gt_right">-3.0189%</td>
  </tr>
  <tr>
    <td class="gt_row gt_left gt_striped">VWS DC Equity</td>
    <td class="gt_row gt_right gt_striped">236</td>
    <td class="gt_row gt_right gt_striped">8.24e-04</td>
    <td class="gt_row gt_right gt_striped">3.65e-02</td>
    <td class="gt_row gt_right gt_striped">44.2567</td>
    <td class="gt_row gt_right gt_striped">0.4657</td>
    <td class="gt_row gt_right gt_striped">4.1393</td>
    <td class="gt_row gt_right gt_striped">-0.3037</td>
    <td class="gt_row gt_right gt_striped">-5.9134%</td>
    <td class="gt_row gt_right gt_striped">-8.3976%</td>
  </tr>
  <tr>
    <td class="gt_row gt_left">EQNR NO Equity</td>
    <td class="gt_row gt_right">236</td>
    <td class="gt_row gt_right">2.28e-04</td>
    <td class="gt_row gt_right">2.06e-02</td>
    <td class="gt_row gt_right">89.9712</td>
    <td class="gt_row gt_right">-0.4305</td>
    <td class="gt_row gt_right">1.9742</td>
    <td class="gt_row gt_right">-0.0465</td>
    <td class="gt_row gt_right">-3.3578%</td>
    <td class="gt_row gt_right">-4.7584%</td>
  </tr>
  <tr>
    <td class="gt_row gt_left gt_striped">TTE FP Equity</td>
    <td class="gt_row gt_right gt_striped">236</td>
    <td class="gt_row gt_right gt_striped">-1.61e-05</td>
    <td class="gt_row gt_right gt_striped">1.33e-02</td>
    <td class="gt_row gt_right gt_striped">-826.4150</td>
    <td class="gt_row gt_right gt_striped">-0.5504</td>
    <td class="gt_row gt_right gt_striped">1.5665</td>
    <td class="gt_row gt_right gt_striped">0.0221</td>
    <td class="gt_row gt_right gt_striped">-2.1924%</td>
    <td class="gt_row gt_right gt_striped">-3.1001%</td>
  </tr>
  <tr>
    <td class="gt_row gt_left">AMRC US Equity</td>
    <td class="gt_row gt_right">236</td>
    <td class="gt_row gt_right">2.69e-03</td>
    <td class="gt_row gt_right">6.25e-02</td>
    <td class="gt_row gt_right">23.2634</td>
    <td class="gt_row gt_right">1.3758</td>
    <td class="gt_row gt_right">19.2682</td>
    <td class="gt_row gt_right">1.0578</td>
    <td class="gt_row gt_right">-10.0197%</td>
    <td class="gt_row gt_right">-14.2824%</td>
  </tr>
  <tr>
    <td class="gt_row gt_left gt_striped">NEE US Equity</td>
    <td class="gt_row gt_right gt_striped">236</td>
    <td class="gt_row gt_right gt_striped">3.13e-04</td>
    <td class="gt_row gt_right gt_striped">1.81e-02</td>
    <td class="gt_row gt_right gt_striped">57.7545</td>
    <td class="gt_row gt_right gt_striped">-0.1578</td>
    <td class="gt_row gt_right gt_striped">1.5681</td>
    <td class="gt_row gt_right gt_striped">0.2967</td>
    <td class="gt_row gt_right gt_striped">-2.9461%</td>
    <td class="gt_row gt_right gt_striped">-4.1797%</td>
  </tr>
</tbody>


</table>

</div>
        
</div>
</div>
<div id="cell-violin_boxplot_enhanced" class="cell" data-execution_count="9">
<details class="code-fold">
<summary>Show code</summary>
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> ptitprince <span class="im">as</span> pt</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>melted <span class="op">=</span> returns.melt(var_name<span class="op">=</span><span class="st">"Asset"</span>, value_name<span class="op">=</span><span class="st">"Return"</span>)</span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">14</span>, <span class="dv">6</span>))</span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a>pt.half_violinplot(</span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a>    x<span class="op">=</span><span class="st">"Asset"</span>,</span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a>    y<span class="op">=</span><span class="st">"Return"</span>,</span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a>    data<span class="op">=</span>melted,</span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a>    palette<span class="op">=</span><span class="st">"tab10"</span>,</span>
<span id="cb13-12"><a href="#cb13-12" aria-hidden="true" tabindex="-1"></a>    bw<span class="op">=</span><span class="fl">.2</span>,</span>
<span id="cb13-13"><a href="#cb13-13" aria-hidden="true" tabindex="-1"></a>    cut<span class="op">=</span><span class="fl">0.</span>,</span>
<span id="cb13-14"><a href="#cb13-14" aria-hidden="true" tabindex="-1"></a>    scale<span class="op">=</span><span class="st">"area"</span>,</span>
<span id="cb13-15"><a href="#cb13-15" aria-hidden="true" tabindex="-1"></a>    inner<span class="op">=</span><span class="va">None</span>,</span>
<span id="cb13-16"><a href="#cb13-16" aria-hidden="true" tabindex="-1"></a>    orient<span class="op">=</span><span class="st">"v"</span></span>
<span id="cb13-17"><a href="#cb13-17" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb13-18"><a href="#cb13-18" aria-hidden="true" tabindex="-1"></a>sns.boxplot(</span>
<span id="cb13-19"><a href="#cb13-19" aria-hidden="true" tabindex="-1"></a>    data<span class="op">=</span>melted,</span>
<span id="cb13-20"><a href="#cb13-20" aria-hidden="true" tabindex="-1"></a>    x<span class="op">=</span><span class="st">"Asset"</span>,</span>
<span id="cb13-21"><a href="#cb13-21" aria-hidden="true" tabindex="-1"></a>    y<span class="op">=</span><span class="st">"Return"</span>,</span>
<span id="cb13-22"><a href="#cb13-22" aria-hidden="true" tabindex="-1"></a>    width<span class="op">=</span><span class="fl">0.2</span>,</span>
<span id="cb13-23"><a href="#cb13-23" aria-hidden="true" tabindex="-1"></a>    palette<span class="op">=</span><span class="st">"tab10"</span>,</span>
<span id="cb13-24"><a href="#cb13-24" aria-hidden="true" tabindex="-1"></a>    showcaps<span class="op">=</span><span class="va">True</span>,</span>
<span id="cb13-25"><a href="#cb13-25" aria-hidden="true" tabindex="-1"></a>    flierprops <span class="op">=</span> <span class="bu">dict</span>(marker<span class="op">=</span><span class="st">'o'</span>, markerfacecolor<span class="op">=</span><span class="st">'black'</span>, markersize<span class="op">=</span><span class="dv">2</span>, linestyle<span class="op">=</span><span class="st">'none'</span>)</span>
<span id="cb13-26"><a href="#cb13-26" aria-hidden="true" tabindex="-1"></a>    <span class="co"># showfliers=False</span></span>
<span id="cb13-27"><a href="#cb13-27" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb13-28"><a href="#cb13-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-29"><a href="#cb13-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-30"><a href="#cb13-30" aria-hidden="true" tabindex="-1"></a><span class="co"># 1. Horizontal Line at y=0 (Zero Return)</span></span>
<span id="cb13-31"><a href="#cb13-31" aria-hidden="true" tabindex="-1"></a>plt.axhline(</span>
<span id="cb13-32"><a href="#cb13-32" aria-hidden="true" tabindex="-1"></a>    y<span class="op">=</span><span class="dv">0</span>, </span>
<span id="cb13-33"><a href="#cb13-33" aria-hidden="true" tabindex="-1"></a>    color<span class="op">=</span><span class="st">'black'</span>, </span>
<span id="cb13-34"><a href="#cb13-34" aria-hidden="true" tabindex="-1"></a>    linestyle<span class="op">=</span><span class="st">'--'</span>, </span>
<span id="cb13-35"><a href="#cb13-35" aria-hidden="true" tabindex="-1"></a>    linewidth<span class="op">=</span><span class="fl">0.8</span>, </span>
<span id="cb13-36"><a href="#cb13-36" aria-hidden="true" tabindex="-1"></a>    alpha<span class="op">=</span><span class="fl">0.7</span>,</span>
<span id="cb13-37"><a href="#cb13-37" aria-hidden="true" tabindex="-1"></a>    label<span class="op">=</span><span class="st">'Zero Return'</span> <span class="co"># Adding a label is good practice</span></span>
<span id="cb13-38"><a href="#cb13-38" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb13-39"><a href="#cb13-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-40"><a href="#cb13-40" aria-hidden="true" tabindex="-1"></a><span class="co"># 2. Vertical Lines to separate Assets/Boxplots</span></span>
<span id="cb13-41"><a href="#cb13-41" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">9</span>): <span class="co"># 10 - 1</span></span>
<span id="cb13-42"><a href="#cb13-42" aria-hidden="true" tabindex="-1"></a>    plt.axvline(</span>
<span id="cb13-43"><a href="#cb13-43" aria-hidden="true" tabindex="-1"></a>        x<span class="op">=</span>i <span class="op">+</span> <span class="fl">0.5</span>, <span class="co"># Place the line exactly between asset i and asset i+1</span></span>
<span id="cb13-44"><a href="#cb13-44" aria-hidden="true" tabindex="-1"></a>        color<span class="op">=</span><span class="st">'gray'</span>, </span>
<span id="cb13-45"><a href="#cb13-45" aria-hidden="true" tabindex="-1"></a>        linestyle<span class="op">=</span><span class="st">'-'</span>, </span>
<span id="cb13-46"><a href="#cb13-46" aria-hidden="true" tabindex="-1"></a>        linewidth<span class="op">=</span><span class="fl">0.5</span>, </span>
<span id="cb13-47"><a href="#cb13-47" aria-hidden="true" tabindex="-1"></a>        alpha<span class="op">=</span><span class="fl">0.5</span></span>
<span id="cb13-48"><a href="#cb13-48" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb13-49"><a href="#cb13-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-50"><a href="#cb13-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-51"><a href="#cb13-51" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">"Violin + Boxplot of Asset Returns"</span>)</span>
<span id="cb13-52"><a href="#cb13-52" aria-hidden="true" tabindex="-1"></a>plt.xticks(rotation<span class="op">=</span><span class="dv">45</span>)</span>
<span id="cb13-53"><a href="#cb13-53" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb13-54"><a href="#cb13-54" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="Groupwork_files/figure-html/violin_boxplot_enhanced-output-1.png" id="violin_boxplot_enhanced" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="cumulative_performance" class="cell" data-execution_count="10">
<details class="code-fold">
<summary>Show code</summary>
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>avgstd <span class="op">=</span> np.mean(desc_stats[<span class="st">"Std"</span>])</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>df2 <span class="op">=</span> df.drop(<span class="st">"SPX Index"</span>, axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">14</span>, <span class="dv">6</span>))</span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> company <span class="kw">in</span> returns.columns:</span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>    plt.plot((np.cumsum(returns[company])))</span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a>plt.legend(labels<span class="op">=</span>returns.columns,loc<span class="op">=</span><span class="st">'center left'</span>, bbox_to_anchor<span class="op">=</span>(<span class="fl">1.02</span>, <span class="fl">0.5</span>), </span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a>    ncol<span class="op">=</span><span class="dv">1</span>,frameon<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">"Cumulative Performance of discrete returns"</span>, fontsize<span class="op">=</span><span class="dv">16</span>)</span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">"Date"</span>, fontsize<span class="op">=</span><span class="dv">16</span>)</span>
<span id="cb14-10"><a href="#cb14-10" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">"Cumulative returns"</span>, fontsize<span class="op">=</span><span class="dv">16</span>)</span>
<span id="cb14-11"><a href="#cb14-11" aria-hidden="true" tabindex="-1"></a>plt.grid(<span class="va">True</span>, linestyle<span class="op">=</span><span class="st">'--'</span>, alpha<span class="op">=</span><span class="fl">0.6</span>)</span>
<span id="cb14-12"><a href="#cb14-12" aria-hidden="true" tabindex="-1"></a>plt.xticks(fontsize<span class="op">=</span><span class="dv">14</span>)  <span class="co"># shrink labels</span></span>
<span id="cb14-13"><a href="#cb14-13" aria-hidden="true" tabindex="-1"></a>plt.yticks(fontsize<span class="op">=</span><span class="dv">14</span>)  <span class="co"># shrink labels</span></span>
<span id="cb14-14"><a href="#cb14-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-15"><a href="#cb14-15" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()                 <span class="co"># makes space for title/axes</span></span>
<span id="cb14-16"><a href="#cb14-16" aria-hidden="true" tabindex="-1"></a>plt.subplots_adjust(right<span class="op">=</span><span class="fl">0.8</span>)     <span class="co"># extra: leaves space for legend</span></span>
<span id="cb14-17"><a href="#cb14-17" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb14-18"><a href="#cb14-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-19"><a href="#cb14-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-20"><a href="#cb14-20" aria-hidden="true" tabindex="-1"></a>low  <span class="op">=</span> <span class="dv">1</span></span>
<span id="cb14-21"><a href="#cb14-21" aria-hidden="true" tabindex="-1"></a>mid  <span class="op">=</span> <span class="dv">2</span></span>
<span id="cb14-22"><a href="#cb14-22" aria-hidden="true" tabindex="-1"></a>high <span class="op">=</span> <span class="dv">3</span></span>
<span id="cb14-23"><a href="#cb14-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-24"><a href="#cb14-24" aria-hidden="true" tabindex="-1"></a><span class="co">#| label: cumulative_performance</span></span>
<span id="cb14-25"><a href="#cb14-25" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">14</span>, <span class="dv">6</span>))</span>
<span id="cb14-26"><a href="#cb14-26" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> company <span class="kw">in</span> returns.columns:</span>
<span id="cb14-27"><a href="#cb14-27" aria-hidden="true" tabindex="-1"></a>    plt.plot(returns[company])</span>
<span id="cb14-28"><a href="#cb14-28" aria-hidden="true" tabindex="-1"></a>plt.legend(labels<span class="op">=</span>returns.columns,loc<span class="op">=</span><span class="st">'center left'</span>, bbox_to_anchor<span class="op">=</span>(<span class="fl">1.02</span>, <span class="fl">0.5</span>), </span>
<span id="cb14-29"><a href="#cb14-29" aria-hidden="true" tabindex="-1"></a>    ncol<span class="op">=</span><span class="dv">1</span>,frameon<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb14-30"><a href="#cb14-30" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">"Daily discrete returns of companies last year"</span>, fontsize<span class="op">=</span><span class="dv">16</span>)</span>
<span id="cb14-31"><a href="#cb14-31" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">"Date"</span>, fontsize<span class="op">=</span><span class="dv">16</span>)</span>
<span id="cb14-32"><a href="#cb14-32" aria-hidden="true" tabindex="-1"></a><span class="co"># plt.axhline(low*avgstd, color='red', linestyle='--', label='Market Beta = 1')</span></span>
<span id="cb14-33"><a href="#cb14-33" aria-hidden="true" tabindex="-1"></a><span class="co"># plt.axhline(mid*avgstd, color='red', linestyle='--', label='Market Beta = 1')</span></span>
<span id="cb14-34"><a href="#cb14-34" aria-hidden="true" tabindex="-1"></a><span class="co"># plt.axhline(high*avgstd, color='red', linestyle='--', label='Market Beta = 1')</span></span>
<span id="cb14-35"><a href="#cb14-35" aria-hidden="true" tabindex="-1"></a><span class="co"># plt.axhline(-low*avgstd, color='red', linestyle='--', label='Market Beta = 1')</span></span>
<span id="cb14-36"><a href="#cb14-36" aria-hidden="true" tabindex="-1"></a><span class="co"># plt.axhline(-mid*avgstd, color='red', linestyle='--', label='Market Beta = 1')</span></span>
<span id="cb14-37"><a href="#cb14-37" aria-hidden="true" tabindex="-1"></a><span class="co"># plt.axhline(-high*avgstd, color='red', linestyle='--', label='Market Beta = 1')</span></span>
<span id="cb14-38"><a href="#cb14-38" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">"Discrete returns"</span>, fontsize<span class="op">=</span><span class="dv">16</span>)</span>
<span id="cb14-39"><a href="#cb14-39" aria-hidden="true" tabindex="-1"></a>plt.grid(<span class="va">True</span>, linestyle<span class="op">=</span><span class="st">'--'</span>, alpha<span class="op">=</span><span class="fl">0.6</span>)</span>
<span id="cb14-40"><a href="#cb14-40" aria-hidden="true" tabindex="-1"></a>plt.xticks(fontsize<span class="op">=</span><span class="dv">14</span>)  <span class="co"># shrink labels</span></span>
<span id="cb14-41"><a href="#cb14-41" aria-hidden="true" tabindex="-1"></a>plt.yticks(fontsize<span class="op">=</span><span class="dv">14</span>)  <span class="co"># shrink labels</span></span>
<span id="cb14-42"><a href="#cb14-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-43"><a href="#cb14-43" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()                 <span class="co"># makes space for title/axes</span></span>
<span id="cb14-44"><a href="#cb14-44" aria-hidden="true" tabindex="-1"></a>plt.subplots_adjust(right<span class="op">=</span><span class="fl">0.8</span>)     <span class="co"># extra: leaves space for legend</span></span>
<span id="cb14-45"><a href="#cb14-45" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb14-46"><a href="#cb14-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-47"><a href="#cb14-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-48"><a href="#cb14-48" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">14</span>, <span class="dv">6</span>))</span>
<span id="cb14-49"><a href="#cb14-49" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> company <span class="kw">in</span> df2.columns:</span>
<span id="cb14-50"><a href="#cb14-50" aria-hidden="true" tabindex="-1"></a>    plt.plot(df2[company])</span>
<span id="cb14-51"><a href="#cb14-51" aria-hidden="true" tabindex="-1"></a>plt.legend(labels<span class="op">=</span>df2.columns,loc<span class="op">=</span><span class="st">'center left'</span>, bbox_to_anchor<span class="op">=</span>(<span class="fl">1.02</span>, <span class="fl">0.5</span>), </span>
<span id="cb14-52"><a href="#cb14-52" aria-hidden="true" tabindex="-1"></a>    ncol<span class="op">=</span><span class="dv">1</span>,frameon<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb14-53"><a href="#cb14-53" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">"Cumulative Performance of discrete returns"</span>, fontsize<span class="op">=</span><span class="dv">16</span>)</span>
<span id="cb14-54"><a href="#cb14-54" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">"Date"</span>, fontsize<span class="op">=</span><span class="dv">16</span>)</span>
<span id="cb14-55"><a href="#cb14-55" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">"Cumulative returns"</span>, fontsize<span class="op">=</span><span class="dv">16</span>)</span>
<span id="cb14-56"><a href="#cb14-56" aria-hidden="true" tabindex="-1"></a>plt.grid(<span class="va">True</span>, linestyle<span class="op">=</span><span class="st">'--'</span>, alpha<span class="op">=</span><span class="fl">0.6</span>)</span>
<span id="cb14-57"><a href="#cb14-57" aria-hidden="true" tabindex="-1"></a>plt.xticks(fontsize<span class="op">=</span><span class="dv">14</span>)  <span class="co"># shrink labels</span></span>
<span id="cb14-58"><a href="#cb14-58" aria-hidden="true" tabindex="-1"></a>plt.yticks(fontsize<span class="op">=</span><span class="dv">14</span>)  <span class="co"># shrink labels</span></span>
<span id="cb14-59"><a href="#cb14-59" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-60"><a href="#cb14-60" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()                 <span class="co"># makes space for title/axes</span></span>
<span id="cb14-61"><a href="#cb14-61" aria-hidden="true" tabindex="-1"></a>plt.subplots_adjust(right<span class="op">=</span><span class="fl">0.8</span>)     <span class="co"># extra: leaves space for legend</span></span>
<span id="cb14-62"><a href="#cb14-62" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb14-63"><a href="#cb14-63" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-64"><a href="#cb14-64" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Day with the lowest returns"</span>)</span>
<span id="cb14-65"><a href="#cb14-65" aria-hidden="true" tabindex="-1"></a>returns.idxmin(axis<span class="op">=</span><span class="dv">0</span>).sort_values()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="Groupwork_files/figure-html/cumulative_performance-output-1.png" id="cumulative_performance-1" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="Groupwork_files/figure-html/cumulative_performance-output-2.png" id="cumulative_performance-2" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="Groupwork_files/figure-html/cumulative_performance-output-3.png" id="cumulative_performance-3" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Day with the lowest returns</code></pre>
</div>
<div id="cumulative_performance-4" class="cell-output cell-output-display" data-execution_count="10">
<pre><code>VWS DC Equity    2024-11-06
AMRC US Equity   2025-02-28
CVX US Equity    2025-04-03
SHEL LN Equity   2025-04-04
TTE FP Equity    2025-04-04
ENI IM Equity    2025-04-07
XOM US Equity    2025-04-10
FSLR US Equity   2025-06-17
EQNR NO Equity   2025-06-24
NEE US Equity    2025-07-23
dtype: datetime64[ns]</code></pre>
</div>
</div>
<div id="d0599c76" class="cell" data-execution_count="11">
<details class="code-fold">
<summary>Show code</summary>
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>cum_perf <span class="op">=</span> (<span class="dv">1</span> <span class="op">+</span> returns).cumprod() <span class="op">-</span> <span class="dv">1</span> <span class="op">+</span><span class="dv">100</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">14</span>, <span class="dv">6</span>))</span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> company <span class="kw">in</span> cum_perf.columns:</span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a>    plt.plot(cum_perf.index, cum_perf[company], label<span class="op">=</span>company)</span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a>plt.legend(loc<span class="op">=</span><span class="st">'center left'</span>, bbox_to_anchor<span class="op">=</span>(<span class="fl">1.02</span>, <span class="fl">0.5</span>),</span>
<span id="cb17-9"><a href="#cb17-9" aria-hidden="true" tabindex="-1"></a>           ncol<span class="op">=</span><span class="dv">1</span>, frameon<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb17-10"><a href="#cb17-10" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">"Cumulative Performance of Stocks"</span>, fontsize<span class="op">=</span><span class="dv">16</span>)</span>
<span id="cb17-11"><a href="#cb17-11" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">"Date"</span>, fontsize<span class="op">=</span><span class="dv">16</span>)</span>
<span id="cb17-12"><a href="#cb17-12" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">"Cumulative Return"</span>, fontsize<span class="op">=</span><span class="dv">16</span>)</span>
<span id="cb17-13"><a href="#cb17-13" aria-hidden="true" tabindex="-1"></a>plt.grid(<span class="va">True</span>, linestyle<span class="op">=</span><span class="st">'--'</span>, alpha<span class="op">=</span><span class="fl">0.6</span>)</span>
<span id="cb17-14"><a href="#cb17-14" aria-hidden="true" tabindex="-1"></a>plt.xticks(fontsize<span class="op">=</span><span class="dv">14</span>)</span>
<span id="cb17-15"><a href="#cb17-15" aria-hidden="true" tabindex="-1"></a>plt.yticks(fontsize<span class="op">=</span><span class="dv">14</span>)</span>
<span id="cb17-16"><a href="#cb17-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-17"><a href="#cb17-17" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb17-18"><a href="#cb17-18" aria-hidden="true" tabindex="-1"></a>plt.subplots_adjust(right<span class="op">=</span><span class="fl">0.8</span>)</span>
<span id="cb17-19"><a href="#cb17-19" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="Groupwork_files/figure-html/cell-12-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="cell-beta_barplot" class="cell" data-execution_count="12">
<details class="code-fold">
<summary>Show code</summary>
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>sorted_beta <span class="op">=</span> beta_df.sort_values(<span class="st">'Beta'</span>, ascending<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>mycolors <span class="op">=</span> [<span class="st">'red'</span> <span class="cf">if</span> v <span class="op">&lt;</span> <span class="dv">0</span> <span class="cf">else</span> <span class="st">'steelblue'</span> <span class="cf">for</span> v <span class="kw">in</span> sorted_beta[<span class="st">'Beta'</span>]]</span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>ax <span class="op">=</span> sorted_beta.plot(kind<span class="op">=</span><span class="st">'bar'</span>, color<span class="op">=</span>mycolors, legend<span class="op">=</span><span class="va">False</span>, figsize<span class="op">=</span>(<span class="dv">9</span>, <span class="dv">6</span>))</span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>plt.axhline(<span class="dv">1</span>, color<span class="op">=</span><span class="st">'red'</span>, linestyle<span class="op">=</span><span class="st">'--'</span>, label<span class="op">=</span><span class="st">'Market Beta = 1'</span>)</span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">'Market Beta per Company'</span>)</span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'Beta'</span>)</span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a>plt.legend()</span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb18-9"><a href="#cb18-9" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb18-10"><a href="#cb18-10" aria-hidden="true" tabindex="-1"></a></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="Groupwork_files/figure-html/beta_barplot-output-1.png" id="beta_barplot" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="cell-correlation_heatmap" class="cell" data-execution_count="13">
<details class="code-fold">
<summary>Show code</summary>
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>corr_matrix <span class="op">=</span> returns.corr(method <span class="op">=</span> <span class="st">'pearson'</span>)</span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">10</span>, <span class="dv">8</span>))</span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>sns.heatmap(corr_matrix, annot<span class="op">=</span><span class="va">True</span>, cmap<span class="op">=</span><span class="st">'coolwarm'</span>, fmt<span class="op">=</span><span class="st">".2f"</span>, annot_kws<span class="op">=</span>{<span class="st">"size"</span>: <span class="dv">10</span>})</span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">"Correlation Matrix of Returns"</span>)</span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="Groupwork_files/figure-html/correlation_heatmap-output-1.png" id="correlation_heatmap" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="correlation_heatmap_difference" class="cell" data-execution_count="14">
<details class="code-fold">
<summary>Show code</summary>
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">10</span>, <span class="dv">8</span>))</span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>sns.heatmap(returns.corr(method <span class="op">=</span> <span class="st">'spearman'</span>) <span class="op">-</span> returns.corr(method <span class="op">=</span> <span class="st">'pearson'</span>), annot<span class="op">=</span><span class="va">True</span>, cmap<span class="op">=</span><span class="st">'coolwarm'</span>, fmt<span class="op">=</span><span class="st">".2f"</span>, annot_kws<span class="op">=</span>{<span class="st">"size"</span>: <span class="dv">10</span>})</span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">"Difference in correlation Matrix of Returns"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div id="correlation_heatmap_difference-1" class="cell-output cell-output-display" data-execution_count="14">
<pre><code>Text(0.5, 1.0, 'Difference in correlation Matrix of Returns')</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="Groupwork_files/figure-html/correlation_heatmap_difference-output-2.png" id="correlation_heatmap_difference-2" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="cell-correlation_heatmap_all" class="cell" data-execution_count="15">
<details class="code-fold">
<summary>Show code</summary>
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">10</span>, <span class="dv">8</span>))</span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>cmap <span class="op">=</span> sns.diverging_palette(<span class="dv">220</span>, <span class="dv">20</span>, as_cmap<span class="op">=</span><span class="va">True</span>)  <span class="co"># alternative: sns.color_palette("vlag", as_cmap=True)</span></span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>sns.heatmap(</span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a>    full_returns.corr(),</span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a>    annot<span class="op">=</span><span class="va">True</span>,</span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a>    fmt<span class="op">=</span><span class="st">".2f"</span>,</span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a>    cmap<span class="op">=</span><span class="st">"coolwarm"</span>,</span>
<span id="cb22-9"><a href="#cb22-9" aria-hidden="true" tabindex="-1"></a>    vmin<span class="op">=-</span><span class="dv">1</span>, vmax<span class="op">=</span><span class="dv">1</span>,      <span class="co"># force scale from -1 to 1</span></span>
<span id="cb22-10"><a href="#cb22-10" aria-hidden="true" tabindex="-1"></a>    center<span class="op">=</span><span class="dv">0</span>,             <span class="co"># center the diverging palette at 0</span></span>
<span id="cb22-11"><a href="#cb22-11" aria-hidden="true" tabindex="-1"></a>    annot_kws<span class="op">=</span>{<span class="st">"size"</span>: <span class="dv">9</span>},</span>
<span id="cb22-12"><a href="#cb22-12" aria-hidden="true" tabindex="-1"></a>    square<span class="op">=</span><span class="va">True</span>,</span>
<span id="cb22-13"><a href="#cb22-13" aria-hidden="true" tabindex="-1"></a>    linewidths<span class="op">=</span><span class="fl">0.0</span>,</span>
<span id="cb22-14"><a href="#cb22-14" aria-hidden="true" tabindex="-1"></a>    cbar_kws<span class="op">=</span>{<span class="st">"shrink"</span>: <span class="fl">0.8</span>, <span class="st">"label"</span>: <span class="st">"Correlation"</span>}</span>
<span id="cb22-15"><a href="#cb22-15" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb22-16"><a href="#cb22-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-17"><a href="#cb22-17" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">"Correlation Matrix of Returns"</span>)</span>
<span id="cb22-18"><a href="#cb22-18" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb22-19"><a href="#cb22-19" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="Groupwork_files/figure-html/correlation_heatmap_all-output-1.png" id="correlation_heatmap_all" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="rolling_analysis_separate" class="cell" data-execution_count="16">
<details class="code-fold">
<summary>Show code</summary>
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Assuming 'returns' DataFrame is already defined, and 'window' is set to 30</span></span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a>window <span class="op">=</span> <span class="dv">30</span></span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a>rolling_mean <span class="op">=</span> returns.rolling(window<span class="op">=</span>window).mean()</span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a>rolling_vol <span class="op">=</span> returns.rolling(window<span class="op">=</span>window).std()</span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-8"><a href="#cb23-8" aria-hidden="true" tabindex="-1"></a><span class="co"># --- Chart 1: Rolling Mean ---</span></span>
<span id="cb23-9"><a href="#cb23-9" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">12</span>, <span class="dv">6</span>))</span>
<span id="cb23-10"><a href="#cb23-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-11"><a href="#cb23-11" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> col <span class="kw">in</span> returns.columns:</span>
<span id="cb23-12"><a href="#cb23-12" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Plotting each asset's rolling mean</span></span>
<span id="cb23-13"><a href="#cb23-13" aria-hidden="true" tabindex="-1"></a>    plt.plot(rolling_mean.index, rolling_mean[col], linewidth<span class="op">=</span><span class="fl">1.5</span>, label<span class="op">=</span>col)</span>
<span id="cb23-14"><a href="#cb23-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-15"><a href="#cb23-15" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="ss">f'</span><span class="sc">{</span>window<span class="sc">}</span><span class="ss">-Day Rolling Mean of Returns'</span>, fontsize<span class="op">=</span><span class="dv">14</span>)</span>
<span id="cb23-16"><a href="#cb23-16" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">'Date'</span>)</span>
<span id="cb23-17"><a href="#cb23-17" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'Rolling Mean Return'</span>)</span>
<span id="cb23-18"><a href="#cb23-18" aria-hidden="true" tabindex="-1"></a>plt.grid(<span class="va">True</span>, linestyle<span class="op">=</span><span class="st">'--'</span>, alpha<span class="op">=</span><span class="fl">0.6</span>)</span>
<span id="cb23-19"><a href="#cb23-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-20"><a href="#cb23-20" aria-hidden="true" tabindex="-1"></a><span class="co"># Legend for Chart 1</span></span>
<span id="cb23-21"><a href="#cb23-21" aria-hidden="true" tabindex="-1"></a>plt.legend(</span>
<span id="cb23-22"><a href="#cb23-22" aria-hidden="true" tabindex="-1"></a>    title<span class="op">=</span><span class="st">'Asset'</span>,</span>
<span id="cb23-23"><a href="#cb23-23" aria-hidden="true" tabindex="-1"></a>    loc<span class="op">=</span><span class="st">'center left'</span>,</span>
<span id="cb23-24"><a href="#cb23-24" aria-hidden="true" tabindex="-1"></a>    bbox_to_anchor<span class="op">=</span>(<span class="fl">1.02</span>, <span class="fl">0.5</span>), <span class="co"># Moves the legend outside the plot area</span></span>
<span id="cb23-25"><a href="#cb23-25" aria-hidden="true" tabindex="-1"></a>    frameon<span class="op">=</span><span class="va">False</span> <span class="co"># Ensure a background for the legend for clarity</span></span>
<span id="cb23-26"><a href="#cb23-26" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb23-27"><a href="#cb23-27" aria-hidden="true" tabindex="-1"></a>plt.tight_layout() <span class="co"># Adjust layout to make room for the legend</span></span>
<span id="cb23-28"><a href="#cb23-28" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb23-29"><a href="#cb23-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-30"><a href="#cb23-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-31"><a href="#cb23-31" aria-hidden="true" tabindex="-1"></a><span class="co"># --- Chart 2: Rolling Volatility ---</span></span>
<span id="cb23-32"><a href="#cb23-32" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">12</span>, <span class="dv">6</span>))</span>
<span id="cb23-33"><a href="#cb23-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-34"><a href="#cb23-34" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> col <span class="kw">in</span> returns.columns:</span>
<span id="cb23-35"><a href="#cb23-35" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Plotting each asset's rolling volatility</span></span>
<span id="cb23-36"><a href="#cb23-36" aria-hidden="true" tabindex="-1"></a>    plt.plot(rolling_vol.index, rolling_vol[col], linewidth<span class="op">=</span><span class="fl">1.5</span>, label<span class="op">=</span>col)</span>
<span id="cb23-37"><a href="#cb23-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-38"><a href="#cb23-38" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="ss">f'</span><span class="sc">{</span>window<span class="sc">}</span><span class="ss">-Day Rolling Volatility (Standard Deviation)'</span>, fontsize<span class="op">=</span><span class="dv">14</span>)</span>
<span id="cb23-39"><a href="#cb23-39" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">'Date'</span>)</span>
<span id="cb23-40"><a href="#cb23-40" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'Rolling Volatility (Std Dev)'</span>)</span>
<span id="cb23-41"><a href="#cb23-41" aria-hidden="true" tabindex="-1"></a>plt.grid(<span class="va">True</span>, linestyle<span class="op">=</span><span class="st">'--'</span>, alpha<span class="op">=</span><span class="fl">0.6</span>)</span>
<span id="cb23-42"><a href="#cb23-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-43"><a href="#cb23-43" aria-hidden="true" tabindex="-1"></a><span class="co"># Legend for Chart 2 (identical placement)</span></span>
<span id="cb23-44"><a href="#cb23-44" aria-hidden="true" tabindex="-1"></a>plt.legend(</span>
<span id="cb23-45"><a href="#cb23-45" aria-hidden="true" tabindex="-1"></a>    title<span class="op">=</span><span class="st">'Asset'</span>,</span>
<span id="cb23-46"><a href="#cb23-46" aria-hidden="true" tabindex="-1"></a>    loc<span class="op">=</span><span class="st">'center left'</span>,</span>
<span id="cb23-47"><a href="#cb23-47" aria-hidden="true" tabindex="-1"></a>    bbox_to_anchor<span class="op">=</span>(<span class="fl">1.02</span>, <span class="fl">0.5</span>),</span>
<span id="cb23-48"><a href="#cb23-48" aria-hidden="true" tabindex="-1"></a>    frameon<span class="op">=</span><span class="va">False</span></span>
<span id="cb23-49"><a href="#cb23-49" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb23-50"><a href="#cb23-50" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb23-51"><a href="#cb23-51" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="Groupwork_files/figure-html/rolling_analysis_separate-output-1.png" id="rolling_analysis_separate-1" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="Groupwork_files/figure-html/rolling_analysis_separate-output-2.png" id="rolling_analysis_separate-2" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="ratios" class="level1">
<h1>RATIOS</h1>
<div id="import_fundamentals" class="cell" data-execution_count="17">
<details class="code-fold">
<summary>Show code</summary>
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>MKT <span class="op">=</span> pd.read_excel(PATH, sheet_name <span class="op">=</span> <span class="st">"MKTCAP"</span>)</span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>PE <span class="op">=</span> pd.read_excel(PATH, sheet_name <span class="op">=</span> <span class="st">"PE"</span>)</span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>EPS <span class="op">=</span> pd.read_excel(PATH, sheet_name <span class="op">=</span> <span class="st">"EPS"</span>)</span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a>ROA <span class="op">=</span> pd.read_excel(PATH, sheet_name <span class="op">=</span> <span class="st">"ROA"</span>)</span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a>ROE <span class="op">=</span> pd.read_excel(PATH, sheet_name <span class="op">=</span> <span class="st">"ROE"</span>)</span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a>ESG <span class="op">=</span> pd.read_excel(PATH, sheet_name <span class="op">=</span> <span class="st">"ESG"</span>)</span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-8"><a href="#cb24-8" aria-hidden="true" tabindex="-1"></a>quarters <span class="op">=</span> PE[<span class="st">"Date"</span>]</span>
<span id="cb24-9"><a href="#cb24-9" aria-hidden="true" tabindex="-1"></a>company_columns <span class="op">=</span> PE.columns[<span class="dv">1</span>:]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div id="cell-EPS_fundamentals_long" class="cell" data-execution_count="18">
<details class="code-fold">
<summary>Show code</summary>
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>PE_long  <span class="op">=</span>  PE.set_index(<span class="st">'Date'</span>).stack().reset_index().rename(columns <span class="op">=</span> {<span class="st">"level_1"</span>:<span class="st">"Company"</span>, <span class="dv">0</span>:<span class="st">"PE"</span>})</span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>MKT_long <span class="op">=</span> MKT.set_index(<span class="st">'Date'</span>).stack().reset_index().rename(columns <span class="op">=</span> {<span class="st">"level_1"</span>:<span class="st">"Company"</span>, <span class="dv">0</span>:<span class="st">"MKT"</span>})</span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a>EPS_long <span class="op">=</span> EPS.set_index(<span class="st">'Date'</span>).stack().reset_index().rename(columns <span class="op">=</span> {<span class="st">"level_1"</span>:<span class="st">"Company"</span>, <span class="dv">0</span>:<span class="st">"EPS"</span>})</span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a>ROA_long <span class="op">=</span> ROA.set_index(<span class="st">'Date'</span>).stack().reset_index().rename(columns <span class="op">=</span> {<span class="st">"level_1"</span>:<span class="st">"Company"</span>, <span class="dv">0</span>:<span class="st">"ROA"</span>})</span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a>ROE_long <span class="op">=</span> ROE.set_index(<span class="st">'Date'</span>).stack().reset_index().rename(columns <span class="op">=</span> {<span class="st">"level_1"</span>:<span class="st">"Company"</span>, <span class="dv">0</span>:<span class="st">"ROE"</span>})</span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a>ESG_long <span class="op">=</span> ESG.set_index(<span class="st">'Date'</span>).stack().reset_index().rename(columns <span class="op">=</span> {<span class="st">"level_1"</span>:<span class="st">"Company"</span>, <span class="dv">0</span>:<span class="st">"ESG"</span>})</span>
<span id="cb25-7"><a href="#cb25-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-8"><a href="#cb25-8" aria-hidden="true" tabindex="-1"></a>df_panel <span class="op">=</span> pd.merge(PE_long,  MKT_long, on<span class="op">=</span>[<span class="st">'Date'</span>, <span class="st">'Company'</span>])</span>
<span id="cb25-9"><a href="#cb25-9" aria-hidden="true" tabindex="-1"></a>df_panel <span class="op">=</span> pd.merge(df_panel, EPS_long, on<span class="op">=</span>[<span class="st">'Date'</span>, <span class="st">'Company'</span>])</span>
<span id="cb25-10"><a href="#cb25-10" aria-hidden="true" tabindex="-1"></a>df_panel.sort_values([<span class="st">'Company'</span>, <span class="st">'Date'</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div id="eps_fundamentals_long" class="cell-output cell-output-display" data-execution_count="18">
<div>

<table class="dataframe table table-sm table-striped small">
  <thead>
    <tr>
      <th></th>
      <th>Date</th>
      <th>Company</th>
      <th>PE</th>
      <th>MKT</th>
      <th>EPS</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>18</th>
      <td>Q1 2025</td>
      <td>AMRC US Equity</td>
      <td>18.6753</td>
      <td>491.7470</td>
      <td>-0.0794</td>
    </tr>
    <tr>
      <th>28</th>
      <td>Q2 2025</td>
      <td>AMRC US Equity</td>
      <td>18.9435</td>
      <td>582.6516</td>
      <td>0.1798</td>
    </tr>
    <tr>
      <th>38</th>
      <td>Q3 2025</td>
      <td>AMRC US Equity</td>
      <td>40.7588</td>
      <td>1314.9483</td>
      <td>0.2596</td>
    </tr>
    <tr>
      <th>8</th>
      <td>Q4 2024</td>
      <td>AMRC US Equity</td>
      <td>35.7656</td>
      <td>983.5896</td>
      <td>0.5543</td>
    </tr>
    <tr>
      <th>10</th>
      <td>Q1 2025</td>
      <td>CVX US Equity</td>
      <td>23.4966</td>
      <td>226783.8792</td>
      <td>1.5960</td>
    </tr>
    <tr>
      <th>20</th>
      <td>Q2 2025</td>
      <td>CVX US Equity</td>
      <td>23.6984</td>
      <td>182343.6950</td>
      <td>1.0861</td>
    </tr>
    <tr>
      <th>30</th>
      <td>Q3 2025</td>
      <td>CVX US Equity</td>
      <td>27.0581</td>
      <td>236228.3970</td>
      <td>1.3572</td>
    </tr>
    <tr>
      <th>0</th>
      <td>Q4 2024</td>
      <td>CVX US Equity</td>
      <td>17.5221</td>
      <td>207916.5329</td>
      <td>1.4443</td>
    </tr>
    <tr>
      <th>12</th>
      <td>Q1 2025</td>
      <td>ENI IM Equity</td>
      <td>18.7783</td>
      <td>37689.4974</td>
      <td>0.3008</td>
    </tr>
    <tr>
      <th>22</th>
      <td>Q2 2025</td>
      <td>ENI IM Equity</td>
      <td>19.0738</td>
      <td>37139.5564</td>
      <td>0.1359</td>
    </tr>
    <tr>
      <th>32</th>
      <td>Q3 2025</td>
      <td>ENI IM Equity</td>
      <td>18.3212</td>
      <td>40864.1228</td>
      <td>0.2166</td>
    </tr>
    <tr>
      <th>2</th>
      <td>Q4 2024</td>
      <td>ENI IM Equity</td>
      <td>16.9689</td>
      <td>35622.1154</td>
      <td>0.0345</td>
    </tr>
    <tr>
      <th>16</th>
      <td>Q1 2025</td>
      <td>EQNR NO Equity</td>
      <td>8.3310</td>
      <td>57323.5871</td>
      <td>0.7702</td>
    </tr>
    <tr>
      <th>26</th>
      <td>Q2 2025</td>
      <td>EQNR NO Equity</td>
      <td>8.3402</td>
      <td>51462.8834</td>
      <td>0.3745</td>
    </tr>
    <tr>
      <th>36</th>
      <td>Q3 2025</td>
      <td>EQNR NO Equity</td>
      <td>11.5145</td>
      <td>46373.2035</td>
      <td>-0.0593</td>
    </tr>
    <tr>
      <th>6</th>
      <td>Q4 2024</td>
      <td>EQNR NO Equity</td>
      <td>7.4988</td>
      <td>52084.9723</td>
      <td>0.5699</td>
    </tr>
    <tr>
      <th>11</th>
      <td>Q1 2025</td>
      <td>FSLR US Equity</td>
      <td>10.1810</td>
      <td>10487.2255</td>
      <td>1.5563</td>
    </tr>
    <tr>
      <th>21</th>
      <td>Q2 2025</td>
      <td>FSLR US Equity</td>
      <td>13.3798</td>
      <td>12945.3486</td>
      <td>2.3894</td>
    </tr>
    <tr>
      <th>31</th>
      <td>Q3 2025</td>
      <td>FSLR US Equity</td>
      <td>16.0091</td>
      <td>17572.8691</td>
      <td>3.1519</td>
    </tr>
    <tr>
      <th>1</th>
      <td>Q4 2024</td>
      <td>FSLR US Equity</td>
      <td>13.9387</td>
      <td>15071.3753</td>
      <td>2.8651</td>
    </tr>
    <tr>
      <th>19</th>
      <td>Q1 2025</td>
      <td>NEE US Equity</td>
      <td>19.8611</td>
      <td>112979.4631</td>
      <td>0.3256</td>
    </tr>
    <tr>
      <th>29</th>
      <td>Q2 2025</td>
      <td>NEE US Equity</td>
      <td>18.6761</td>
      <td>104207.5043</td>
      <td>0.7415</td>
    </tr>
    <tr>
      <th>39</th>
      <td>Q3 2025</td>
      <td>NEE US Equity</td>
      <td>19.6291</td>
      <td>115503.3788</td>
      <td>0.8751</td>
    </tr>
    <tr>
      <th>9</th>
      <td>Q4 2024</td>
      <td>NEE US Equity</td>
      <td>22.2759</td>
      <td>117759.9181</td>
      <td>0.4528</td>
    </tr>
    <tr>
      <th>14</th>
      <td>Q1 2025</td>
      <td>SHEL LN Equity</td>
      <td>16.7258</td>
      <td>169983.4394</td>
      <td>0.6273</td>
    </tr>
    <tr>
      <th>24</th>
      <td>Q2 2025</td>
      <td>SHEL LN Equity</td>
      <td>15.6333</td>
      <td>150971.7067</td>
      <td>0.4569</td>
    </tr>
    <tr>
      <th>34</th>
      <td>Q3 2025</td>
      <td>SHEL LN Equity</td>
      <td>14.4794</td>
      <td>153793.5592</td>
      <td>0.6749</td>
    </tr>
    <tr>
      <th>4</th>
      <td>Q4 2024</td>
      <td>SHEL LN Equity</td>
      <td>12.2518</td>
      <td>151408.1715</td>
      <td>0.1171</td>
    </tr>
    <tr>
      <th>17</th>
      <td>Q1 2025</td>
      <td>TTE FP Equity</td>
      <td>10.8453</td>
      <td>113449.0273</td>
      <td>1.3419</td>
    </tr>
    <tr>
      <th>27</th>
      <td>Q2 2025</td>
      <td>TTE FP Equity</td>
      <td>11.0459</td>
      <td>101444.4930</td>
      <td>0.8839</td>
    </tr>
    <tr>
      <th>37</th>
      <td>Q3 2025</td>
      <td>TTE FP Equity</td>
      <td>9.7443</td>
      <td>99711.8954</td>
      <td>1.2237</td>
    </tr>
    <tr>
      <th>7</th>
      <td>Q4 2024</td>
      <td>TTE FP Equity</td>
      <td>8.2712</td>
      <td>105783.2996</td>
      <td>1.3439</td>
    </tr>
    <tr>
      <th>15</th>
      <td>Q1 2025</td>
      <td>VWS DC Equity</td>
      <td>22.2552</td>
      <td>10762.7300</td>
      <td>0.0000</td>
    </tr>
    <tr>
      <th>25</th>
      <td>Q2 2025</td>
      <td>VWS DC Equity</td>
      <td>16.7213</td>
      <td>11032.0113</td>
      <td>0.0255</td>
    </tr>
    <tr>
      <th>35</th>
      <td>Q3 2025</td>
      <td>VWS DC Equity</td>
      <td>17.2261</td>
      <td>14157.8123</td>
      <td>0.2600</td>
    </tr>
    <tr>
      <th>5</th>
      <td>Q4 2024</td>
      <td>VWS DC Equity</td>
      <td>26.2158</td>
      <td>11004.1938</td>
      <td>0.5008</td>
    </tr>
    <tr>
      <th>13</th>
      <td>Q1 2025</td>
      <td>XOM US Equity</td>
      <td>15.8763</td>
      <td>399825.1447</td>
      <td>1.3975</td>
    </tr>
    <tr>
      <th>23</th>
      <td>Q2 2025</td>
      <td>XOM US Equity</td>
      <td>15.4197</td>
      <td>338762.6257</td>
      <td>1.2284</td>
    </tr>
    <tr>
      <th>33</th>
      <td>Q3 2025</td>
      <td>XOM US Equity</td>
      <td>16.7982</td>
      <td>357144.7371</td>
      <td>1.3053</td>
    </tr>
    <tr>
      <th>3</th>
      <td>Q4 2024</td>
      <td>XOM US Equity</td>
      <td>13.8069</td>
      <td>377650.2270</td>
      <td>1.3428</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
<div id="cell-ROA_fundamentals_ratios" class="cell" data-execution_count="19">
<details class="code-fold">
<summary>Show code</summary>
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>df_panel_ratios <span class="op">=</span> pd.merge(ROE_long, ROA_long, on<span class="op">=</span>[<span class="st">'Date'</span>, <span class="st">'Company'</span>])</span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>df_panel_ratios <span class="op">=</span> pd.merge(df_panel_ratios, ESG_long, on<span class="op">=</span>[<span class="st">'Date'</span>, <span class="st">'Company'</span>])</span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a>df_panel_ratios</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div id="roa_fundamentals_ratios" class="cell-output cell-output-display" data-execution_count="19">
<div>

<table class="dataframe table table-sm table-striped small">
  <thead>
    <tr>
      <th></th>
      <th>Date</th>
      <th>Company</th>
      <th>ROE</th>
      <th>ROA</th>
      <th>ESG</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>Q3 2025</td>
      <td>CVX US Equity</td>
      <td>7.3794</td>
      <td>4.3597</td>
      <td>3.03</td>
    </tr>
    <tr>
      <th>1</th>
      <td>Q3 2025</td>
      <td>FSLR US Equity</td>
      <td>16.8639</td>
      <td>11.2505</td>
      <td>5.57</td>
    </tr>
    <tr>
      <th>2</th>
      <td>Q3 2025</td>
      <td>ENI IM Equity</td>
      <td>5.2792</td>
      <td>2.0033</td>
      <td>7.09</td>
    </tr>
    <tr>
      <th>3</th>
      <td>Q3 2025</td>
      <td>XOM US Equity</td>
      <td>18.3731</td>
      <td>6.5381</td>
      <td>3.27</td>
    </tr>
    <tr>
      <th>4</th>
      <td>Q3 2025</td>
      <td>SHEL LN Equity</td>
      <td>8.0496</td>
      <td>3.7868</td>
      <td>3.51</td>
    </tr>
    <tr>
      <th>5</th>
      <td>Q3 2025</td>
      <td>VWS DC Equity</td>
      <td>29.4007</td>
      <td>3.8371</td>
      <td>5.11</td>
    </tr>
    <tr>
      <th>6</th>
      <td>Q3 2025</td>
      <td>EQNR NO Equity</td>
      <td>13.4925</td>
      <td>4.2264</td>
      <td>2.19</td>
    </tr>
    <tr>
      <th>7</th>
      <td>Q3 2025</td>
      <td>TTE FP Equity</td>
      <td>12.2564</td>
      <td>4.9229</td>
      <td>6.53</td>
    </tr>
    <tr>
      <th>8</th>
      <td>Q3 2025</td>
      <td>AMRC US Equity</td>
      <td>6.3219</td>
      <td>1.4984</td>
      <td>1.68</td>
    </tr>
    <tr>
      <th>9</th>
      <td>Q3 2025</td>
      <td>NEE US Equity</td>
      <td>12.4760</td>
      <td>3.3312</td>
      <td>6.56</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
<div id="cell-lmplot_PE_MKT" class="cell" data-execution_count="20">
<details class="code-fold">
<summary>Show code</summary>
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="co">#! melted data / panel for lmplot</span></span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>g <span class="op">=</span> sns.lmplot(</span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a>    data<span class="op">=</span>df_panel,</span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a>    x<span class="op">=</span><span class="st">'PE'</span>,</span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a>    y<span class="op">=</span><span class="st">'MKT'</span>,</span>
<span id="cb27-6"><a href="#cb27-6" aria-hidden="true" tabindex="-1"></a>    hue<span class="op">=</span><span class="st">'Company'</span>,           <span class="co"># color = company</span></span>
<span id="cb27-7"><a href="#cb27-7" aria-hidden="true" tabindex="-1"></a>    scatter<span class="op">=</span><span class="va">True</span>,            <span class="co"># geom_point</span></span>
<span id="cb27-8"><a href="#cb27-8" aria-hidden="true" tabindex="-1"></a>    aspect<span class="op">=</span><span class="fl">1.5</span>,              <span class="co"># aspect ratio</span></span>
<span id="cb27-9"><a href="#cb27-9" aria-hidden="true" tabindex="-1"></a>    height<span class="op">=</span><span class="dv">6</span>,                <span class="co"># height</span></span>
<span id="cb27-10"><a href="#cb27-10" aria-hidden="true" tabindex="-1"></a>    ci<span class="op">=</span> <span class="va">None</span>                 <span class="co"># Set to None to hide the confidence band for cleaner look</span></span>
<span id="cb27-11"><a href="#cb27-11" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb27-12"><a href="#cb27-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-13"><a href="#cb27-13" aria-hidden="true" tabindex="-1"></a><span class="co"># --- 3. Apply Log Scales and Final Formatting ---</span></span>
<span id="cb27-14"><a href="#cb27-14" aria-hidden="true" tabindex="-1"></a><span class="co"># g.ax.set_xscale('log')</span></span>
<span id="cb27-15"><a href="#cb27-15" aria-hidden="true" tabindex="-1"></a><span class="co"># g.ax.set_yscale('log')</span></span>
<span id="cb27-16"><a href="#cb27-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-17"><a href="#cb27-17" aria-hidden="true" tabindex="-1"></a><span class="co"># Re-label the axes to reflect the log scale</span></span>
<span id="cb27-18"><a href="#cb27-18" aria-hidden="true" tabindex="-1"></a>g.set_axis_labels(<span class="st">"PE Ratio (Log Scale)"</span>, <span class="st">"Market Cap (Log Scale)"</span>)</span>
<span id="cb27-19"><a href="#cb27-19" aria-hidden="true" tabindex="-1"></a>g.fig.suptitle(<span class="st">"PE Ratio vs. Market Cap: Separate Trend Line Per Company"</span>, y<span class="op">=</span><span class="fl">1.02</span>)</span>
<span id="cb27-20"><a href="#cb27-20" aria-hidden="true" tabindex="-1"></a>plt.grid(<span class="va">True</span>, which<span class="op">=</span><span class="st">"both"</span>, ls<span class="op">=</span><span class="st">"--"</span>, alpha<span class="op">=</span><span class="fl">0.6</span>)</span>
<span id="cb27-21"><a href="#cb27-21" aria-hidden="true" tabindex="-1"></a><span class="co"># Adjust the legend position</span></span>
<span id="cb27-22"><a href="#cb27-22" aria-hidden="true" tabindex="-1"></a>g.legend.set_title(<span class="st">"Company"</span>)</span>
<span id="cb27-23"><a href="#cb27-23" aria-hidden="true" tabindex="-1"></a>g.legend.set_bbox_to_anchor((<span class="fl">1.05</span>, <span class="fl">0.5</span>))</span>
<span id="cb27-24"><a href="#cb27-24" aria-hidden="true" tabindex="-1"></a></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="Groupwork_files/figure-html/lmplot_pe_mkt-output-1.png" id="lmplot_pe_mkt" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<section id="scatter-with-groups" class="level3">
<h3 class="anchored" data-anchor-id="scatter-with-groups">Scatter with groups</h3>
<div id="scatter_with_groups" class="cell" data-execution_count="21">
<details class="code-fold">
<summary>Show code</summary>
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> Quick_scatter(Data1, Data2, label1, label2, ylog<span class="op">=</span><span class="va">False</span>, xlog<span class="op">=</span><span class="va">False</span>, panelreg <span class="op">=</span> <span class="va">False</span>, groupreg <span class="op">=</span> <span class="va">True</span>):</span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Collect all data for panel regression</span></span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a>    all_data1 <span class="op">=</span> []</span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a>    all_data2 <span class="op">=</span> []</span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a>    plt.figure(figsize<span class="op">=</span>(<span class="dv">12</span>, <span class="dv">6</span>))</span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb28-7"><a href="#cb28-7" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> groupreg:</span>
<span id="cb28-8"><a href="#cb28-8" aria-hidden="true" tabindex="-1"></a>    <span class="co"># ---- classify companies ----</span></span>
<span id="cb28-9"><a href="#cb28-9" aria-hidden="true" tabindex="-1"></a>        green_status <span class="op">=</span> {</span>
<span id="cb28-10"><a href="#cb28-10" aria-hidden="true" tabindex="-1"></a>            <span class="st">"CVX US Equity"</span>: <span class="st">"no"</span>,</span>
<span id="cb28-11"><a href="#cb28-11" aria-hidden="true" tabindex="-1"></a>            <span class="st">"FSLR US Equity"</span>: <span class="st">"yes"</span>,</span>
<span id="cb28-12"><a href="#cb28-12" aria-hidden="true" tabindex="-1"></a>            <span class="st">"ENI IM Equity"</span>: <span class="st">"some"</span>,</span>
<span id="cb28-13"><a href="#cb28-13" aria-hidden="true" tabindex="-1"></a>            <span class="st">"XOM US Equity"</span>: <span class="st">"no"</span>,</span>
<span id="cb28-14"><a href="#cb28-14" aria-hidden="true" tabindex="-1"></a>            <span class="st">"SHEL LN Equity"</span>: <span class="st">"no"</span>,</span>
<span id="cb28-15"><a href="#cb28-15" aria-hidden="true" tabindex="-1"></a>            <span class="st">"VWS DC Equity"</span>: <span class="st">"yes"</span>,</span>
<span id="cb28-16"><a href="#cb28-16" aria-hidden="true" tabindex="-1"></a>            <span class="st">"EQNR NO Equity"</span>: <span class="st">"some"</span>,</span>
<span id="cb28-17"><a href="#cb28-17" aria-hidden="true" tabindex="-1"></a>            <span class="st">"TTE FP Equity"</span>: <span class="st">"some"</span>,</span>
<span id="cb28-18"><a href="#cb28-18" aria-hidden="true" tabindex="-1"></a>            <span class="st">"AMRC US Equity"</span>: <span class="st">"yes"</span>,</span>
<span id="cb28-19"><a href="#cb28-19" aria-hidden="true" tabindex="-1"></a>            <span class="st">"NEE US Equity"</span>: <span class="st">"yes"</span></span>
<span id="cb28-20"><a href="#cb28-20" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb28-21"><a href="#cb28-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-22"><a href="#cb28-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-23"><a href="#cb28-23" aria-hidden="true" tabindex="-1"></a>        <span class="co"># If you want: define green = yes only</span></span>
<span id="cb28-24"><a href="#cb28-24" aria-hidden="true" tabindex="-1"></a>        green_companies <span class="op">=</span> [c <span class="cf">for</span> c,s <span class="kw">in</span> green_status.items() <span class="cf">if</span> s <span class="op">==</span> <span class="st">"yes"</span>]</span>
<span id="cb28-25"><a href="#cb28-25" aria-hidden="true" tabindex="-1"></a>        non_green_companies <span class="op">=</span> [c <span class="cf">for</span> c,s <span class="kw">in</span> green_status.items() <span class="cf">if</span> s <span class="op">==</span> <span class="st">"no"</span>]</span>
<span id="cb28-26"><a href="#cb28-26" aria-hidden="true" tabindex="-1"></a>        some_companies <span class="op">=</span> [c <span class="cf">for</span> c,s <span class="kw">in</span> green_status.items() <span class="cf">if</span> s <span class="op">==</span> <span class="st">"some"</span>]  <span class="co"># optional</span></span>
<span id="cb28-27"><a href="#cb28-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-28"><a href="#cb28-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-29"><a href="#cb28-29" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Also prepare lists for green/non-green group regressions</span></span>
<span id="cb28-30"><a href="#cb28-30" aria-hidden="true" tabindex="-1"></a>        green_x <span class="op">=</span> []</span>
<span id="cb28-31"><a href="#cb28-31" aria-hidden="true" tabindex="-1"></a>        green_y <span class="op">=</span> []</span>
<span id="cb28-32"><a href="#cb28-32" aria-hidden="true" tabindex="-1"></a>        nongreen_x <span class="op">=</span> []</span>
<span id="cb28-33"><a href="#cb28-33" aria-hidden="true" tabindex="-1"></a>        nongreen_y <span class="op">=</span> []</span>
<span id="cb28-34"><a href="#cb28-34" aria-hidden="true" tabindex="-1"></a>        some_x <span class="op">=</span> []</span>
<span id="cb28-35"><a href="#cb28-35" aria-hidden="true" tabindex="-1"></a>        some_y <span class="op">=</span> []</span>
<span id="cb28-36"><a href="#cb28-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-37"><a href="#cb28-37" aria-hidden="true" tabindex="-1"></a>    <span class="co"># --- Plot scatter + company-level regressions ---</span></span>
<span id="cb28-38"><a href="#cb28-38" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> company <span class="kw">in</span> company_columns:</span>
<span id="cb28-39"><a href="#cb28-39" aria-hidden="true" tabindex="-1"></a>        Data1_series <span class="op">=</span> Data1[company]</span>
<span id="cb28-40"><a href="#cb28-40" aria-hidden="true" tabindex="-1"></a>        Data2_series <span class="op">=</span> Data2[company]</span>
<span id="cb28-41"><a href="#cb28-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-42"><a href="#cb28-42" aria-hidden="true" tabindex="-1"></a>        all_data1.append(Data1_series)</span>
<span id="cb28-43"><a href="#cb28-43" aria-hidden="true" tabindex="-1"></a>        all_data2.append(Data2_series)</span>
<span id="cb28-44"><a href="#cb28-44" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> groupreg:</span>
<span id="cb28-45"><a href="#cb28-45" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Add to correct group</span></span>
<span id="cb28-46"><a href="#cb28-46" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> company <span class="kw">in</span> green_companies:</span>
<span id="cb28-47"><a href="#cb28-47" aria-hidden="true" tabindex="-1"></a>                green_x.append(Data1_series)</span>
<span id="cb28-48"><a href="#cb28-48" aria-hidden="true" tabindex="-1"></a>                green_y.append(Data2_series)</span>
<span id="cb28-49"><a href="#cb28-49" aria-hidden="true" tabindex="-1"></a>            <span class="cf">elif</span> company <span class="kw">in</span> non_green_companies:</span>
<span id="cb28-50"><a href="#cb28-50" aria-hidden="true" tabindex="-1"></a>                nongreen_x.append(Data1_series)</span>
<span id="cb28-51"><a href="#cb28-51" aria-hidden="true" tabindex="-1"></a>                nongreen_y.append(Data2_series)</span>
<span id="cb28-52"><a href="#cb28-52" aria-hidden="true" tabindex="-1"></a>            <span class="cf">elif</span> company <span class="kw">in</span> some_companies:</span>
<span id="cb28-53"><a href="#cb28-53" aria-hidden="true" tabindex="-1"></a>                some_x.append(Data1_series)</span>
<span id="cb28-54"><a href="#cb28-54" aria-hidden="true" tabindex="-1"></a>                some_y.append(Data2_series)</span>
<span id="cb28-55"><a href="#cb28-55" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-56"><a href="#cb28-56" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Company scatter</span></span>
<span id="cb28-57"><a href="#cb28-57" aria-hidden="true" tabindex="-1"></a>        plt.scatter(Data1_series, Data2_series, label<span class="op">=</span>company)</span>
<span id="cb28-58"><a href="#cb28-58" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-59"><a href="#cb28-59" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Company individual regression</span></span>
<span id="cb28-60"><a href="#cb28-60" aria-hidden="true" tabindex="-1"></a>        <span class="co"># sns.regplot(</span></span>
<span id="cb28-61"><a href="#cb28-61" aria-hidden="true" tabindex="-1"></a>        <span class="co">#     x=Data1_series.values,</span></span>
<span id="cb28-62"><a href="#cb28-62" aria-hidden="true" tabindex="-1"></a>        <span class="co">#     y=Data2_series.values,</span></span>
<span id="cb28-63"><a href="#cb28-63" aria-hidden="true" tabindex="-1"></a>        <span class="co">#     scatter=False,</span></span>
<span id="cb28-64"><a href="#cb28-64" aria-hidden="true" tabindex="-1"></a>        <span class="co">#     ci=None,</span></span>
<span id="cb28-65"><a href="#cb28-65" aria-hidden="true" tabindex="-1"></a>        <span class="co">#     line_kws={'alpha': 0.6, 'linewidth': 1}</span></span>
<span id="cb28-66"><a href="#cb28-66" aria-hidden="true" tabindex="-1"></a>        <span class="co"># )</span></span>
<span id="cb28-67"><a href="#cb28-67" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-68"><a href="#cb28-68" aria-hidden="true" tabindex="-1"></a>    <span class="co"># --- Convert group lists ---</span></span>
<span id="cb28-69"><a href="#cb28-69" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> groupreg:</span>
<span id="cb28-70"><a href="#cb28-70" aria-hidden="true" tabindex="-1"></a>        gx <span class="op">=</span> pd.concat(green_x).values <span class="cf">if</span> green_x <span class="cf">else</span> <span class="va">None</span></span>
<span id="cb28-71"><a href="#cb28-71" aria-hidden="true" tabindex="-1"></a>        gy <span class="op">=</span> pd.concat(green_y).values <span class="cf">if</span> green_y <span class="cf">else</span> <span class="va">None</span></span>
<span id="cb28-72"><a href="#cb28-72" aria-hidden="true" tabindex="-1"></a>        nx <span class="op">=</span> pd.concat(nongreen_x).values <span class="cf">if</span> nongreen_x <span class="cf">else</span> <span class="va">None</span></span>
<span id="cb28-73"><a href="#cb28-73" aria-hidden="true" tabindex="-1"></a>        ny <span class="op">=</span> pd.concat(nongreen_y).values <span class="cf">if</span> nongreen_y <span class="cf">else</span> <span class="va">None</span></span>
<span id="cb28-74"><a href="#cb28-74" aria-hidden="true" tabindex="-1"></a>        sx <span class="op">=</span> pd.concat(some_x).values <span class="cf">if</span> some_x <span class="cf">else</span> <span class="va">None</span></span>
<span id="cb28-75"><a href="#cb28-75" aria-hidden="true" tabindex="-1"></a>        sy <span class="op">=</span> pd.concat(some_y).values <span class="cf">if</span> some_y <span class="cf">else</span> <span class="va">None</span></span>
<span id="cb28-76"><a href="#cb28-76" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-77"><a href="#cb28-77" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> panelreg:</span>
<span id="cb28-78"><a href="#cb28-78" aria-hidden="true" tabindex="-1"></a>        <span class="co"># --- Panel-wide regression ---</span></span>
<span id="cb28-79"><a href="#cb28-79" aria-hidden="true" tabindex="-1"></a>        all_x <span class="op">=</span> pd.concat(all_data1).values</span>
<span id="cb28-80"><a href="#cb28-80" aria-hidden="true" tabindex="-1"></a>        all_y <span class="op">=</span> pd.concat(all_data2).values</span>
<span id="cb28-81"><a href="#cb28-81" aria-hidden="true" tabindex="-1"></a>        sns.regplot(</span>
<span id="cb28-82"><a href="#cb28-82" aria-hidden="true" tabindex="-1"></a>            x<span class="op">=</span>all_x, y<span class="op">=</span>all_y,</span>
<span id="cb28-83"><a href="#cb28-83" aria-hidden="true" tabindex="-1"></a>            scatter<span class="op">=</span><span class="va">False</span>, ci<span class="op">=</span><span class="va">None</span>,</span>
<span id="cb28-84"><a href="#cb28-84" aria-hidden="true" tabindex="-1"></a>            label<span class="op">=</span><span class="st">'Panel-Wide Regression'</span>,</span>
<span id="cb28-85"><a href="#cb28-85" aria-hidden="true" tabindex="-1"></a>            line_kws<span class="op">=</span>{<span class="st">'color'</span>: <span class="st">'blue'</span>, <span class="st">'linewidth'</span>: <span class="dv">4</span>, <span class="st">'alpha'</span>: <span class="fl">0.2</span>}</span>
<span id="cb28-86"><a href="#cb28-86" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb28-87"><a href="#cb28-87" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-88"><a href="#cb28-88" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> groupreg:</span>
<span id="cb28-89"><a href="#cb28-89" aria-hidden="true" tabindex="-1"></a>        <span class="co"># --- Group Regressions ---</span></span>
<span id="cb28-90"><a href="#cb28-90" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> gx <span class="kw">is</span> <span class="kw">not</span> <span class="va">None</span>:</span>
<span id="cb28-91"><a href="#cb28-91" aria-hidden="true" tabindex="-1"></a>            sns.regplot(</span>
<span id="cb28-92"><a href="#cb28-92" aria-hidden="true" tabindex="-1"></a>                x<span class="op">=</span>gx, y<span class="op">=</span>gy,</span>
<span id="cb28-93"><a href="#cb28-93" aria-hidden="true" tabindex="-1"></a>                scatter<span class="op">=</span><span class="va">False</span>, ci<span class="op">=</span><span class="va">None</span>,</span>
<span id="cb28-94"><a href="#cb28-94" aria-hidden="true" tabindex="-1"></a>                label<span class="op">=</span><span class="st">'Aligned Companies'</span>,</span>
<span id="cb28-95"><a href="#cb28-95" aria-hidden="true" tabindex="-1"></a>                line_kws<span class="op">=</span>{<span class="st">'color'</span>: <span class="st">'green'</span>, <span class="st">'linewidth'</span>: <span class="dv">5</span>, <span class="st">'alpha'</span>: <span class="fl">0.2</span>}</span>
<span id="cb28-96"><a href="#cb28-96" aria-hidden="true" tabindex="-1"></a>            )</span>
<span id="cb28-97"><a href="#cb28-97" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-98"><a href="#cb28-98" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> nx <span class="kw">is</span> <span class="kw">not</span> <span class="va">None</span>:</span>
<span id="cb28-99"><a href="#cb28-99" aria-hidden="true" tabindex="-1"></a>            sns.regplot(</span>
<span id="cb28-100"><a href="#cb28-100" aria-hidden="true" tabindex="-1"></a>                x<span class="op">=</span>nx, y<span class="op">=</span>ny,</span>
<span id="cb28-101"><a href="#cb28-101" aria-hidden="true" tabindex="-1"></a>                scatter<span class="op">=</span><span class="va">False</span>, ci<span class="op">=</span><span class="va">None</span>,</span>
<span id="cb28-102"><a href="#cb28-102" aria-hidden="true" tabindex="-1"></a>                label<span class="op">=</span><span class="st">'Unprepared Companies'</span>,</span>
<span id="cb28-103"><a href="#cb28-103" aria-hidden="true" tabindex="-1"></a>                line_kws<span class="op">=</span>{<span class="st">'color'</span>: <span class="st">'red'</span>, <span class="st">'linewidth'</span>: <span class="dv">5</span>, <span class="st">'alpha'</span>: <span class="fl">0.2</span>}</span>
<span id="cb28-104"><a href="#cb28-104" aria-hidden="true" tabindex="-1"></a>            )</span>
<span id="cb28-105"><a href="#cb28-105" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-106"><a href="#cb28-106" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> sx <span class="kw">is</span> <span class="kw">not</span> <span class="va">None</span>:</span>
<span id="cb28-107"><a href="#cb28-107" aria-hidden="true" tabindex="-1"></a>            sns.regplot(</span>
<span id="cb28-108"><a href="#cb28-108" aria-hidden="true" tabindex="-1"></a>                x<span class="op">=</span>sx, y<span class="op">=</span>sy,</span>
<span id="cb28-109"><a href="#cb28-109" aria-hidden="true" tabindex="-1"></a>                scatter<span class="op">=</span><span class="va">False</span>, ci<span class="op">=</span><span class="va">None</span>,</span>
<span id="cb28-110"><a href="#cb28-110" aria-hidden="true" tabindex="-1"></a>                label<span class="op">=</span><span class="st">'Developing Companies'</span>,</span>
<span id="cb28-111"><a href="#cb28-111" aria-hidden="true" tabindex="-1"></a>                line_kws<span class="op">=</span>{<span class="st">'color'</span>: <span class="st">'gray'</span>, <span class="st">'linewidth'</span>: <span class="dv">5</span>, <span class="st">'alpha'</span>: <span class="fl">0.2</span>}</span>
<span id="cb28-112"><a href="#cb28-112" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb28-113"><a href="#cb28-113" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-114"><a href="#cb28-114" aria-hidden="true" tabindex="-1"></a>    <span class="co"># --- Formatting ---</span></span>
<span id="cb28-115"><a href="#cb28-115" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> xlog:</span>
<span id="cb28-116"><a href="#cb28-116" aria-hidden="true" tabindex="-1"></a>        plt.xscale(<span class="st">'log'</span>)</span>
<span id="cb28-117"><a href="#cb28-117" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> ylog:</span>
<span id="cb28-118"><a href="#cb28-118" aria-hidden="true" tabindex="-1"></a>        plt.yscale(<span class="st">'log'</span>)</span>
<span id="cb28-119"><a href="#cb28-119" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-120"><a href="#cb28-120" aria-hidden="true" tabindex="-1"></a>    plt.title(<span class="ss">f'</span><span class="sc">{</span>label1<span class="sc">}</span><span class="ss"> vs. </span><span class="sc">{</span>label2<span class="sc">}</span><span class="ss"> (with group regressions)'</span>, fontsize<span class="op">=</span><span class="dv">14</span>)</span>
<span id="cb28-121"><a href="#cb28-121" aria-hidden="true" tabindex="-1"></a>    plt.xlabel(label1)</span>
<span id="cb28-122"><a href="#cb28-122" aria-hidden="true" tabindex="-1"></a>    plt.ylabel(label2)</span>
<span id="cb28-123"><a href="#cb28-123" aria-hidden="true" tabindex="-1"></a>    plt.grid(<span class="va">True</span>, ls<span class="op">=</span><span class="st">"--"</span>, alpha<span class="op">=</span><span class="fl">0.6</span>)</span>
<span id="cb28-124"><a href="#cb28-124" aria-hidden="true" tabindex="-1"></a>    plt.legend(loc<span class="op">=</span><span class="st">'center left'</span>, bbox_to_anchor<span class="op">=</span>(<span class="fl">1.02</span>, <span class="fl">0.5</span>), frameon<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb28-125"><a href="#cb28-125" aria-hidden="true" tabindex="-1"></a>    plt.tight_layout()</span>
<span id="cb28-126"><a href="#cb28-126" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-127"><a href="#cb28-127" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-128"><a href="#cb28-128" aria-hidden="true" tabindex="-1"></a>Quick_scatter(PE, MKT, <span class="st">"PE ratio"</span>, <span class="st">"Market cap"</span>, ylog <span class="op">=</span> <span class="va">False</span>, panelreg <span class="op">=</span> <span class="va">True</span>)</span>
<span id="cb28-129"><a href="#cb28-129" aria-hidden="true" tabindex="-1"></a>Quick_scatter(EPS, MKT, <span class="st">"Earnings per share"</span>, <span class="st">"Market cap"</span>, ylog <span class="op">=</span> <span class="va">False</span>, panelreg <span class="op">=</span> <span class="va">True</span>)</span>
<span id="cb28-130"><a href="#cb28-130" aria-hidden="true" tabindex="-1"></a>Quick_scatter(EPS, PE, <span class="st">"Earnings per share"</span>, <span class="st">"PE ratio"</span>, panelreg <span class="op">=</span> <span class="va">True</span>)</span>
<span id="cb28-131"><a href="#cb28-131" aria-hidden="true" tabindex="-1"></a>Quick_scatter(ROE, ROA, <span class="st">"Returns on Equity"</span>, <span class="st">"Returns on Assets"</span>, panelreg <span class="op">=</span> <span class="va">True</span>)</span>
<span id="cb28-132"><a href="#cb28-132" aria-hidden="true" tabindex="-1"></a><span class="co"># Quick_scatter_1reg(ESG, PE, "ESG score", "PE ratio")</span></span>
<span id="cb28-133"><a href="#cb28-133" aria-hidden="true" tabindex="-1"></a><span class="co"># Quick_scatter_1reg(ESG, EPS, "ESG score", "Earnings per share")</span></span>
<span id="cb28-134"><a href="#cb28-134" aria-hidden="true" tabindex="-1"></a><span class="co"># Quick_scatter_1reg(ESG, ROE, "ESG score", "Returns on Equity")</span></span>
<span id="cb28-135"><a href="#cb28-135" aria-hidden="true" tabindex="-1"></a><span class="co"># Quick_scatter_1reg(ESG, ROA, "ESG score", "Returns on Assets")</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="Groupwork_files/figure-html/scatter_with_groups-output-1.png" id="scatter_with_groups-1" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="Groupwork_files/figure-html/scatter_with_groups-output-2.png" id="scatter_with_groups-2" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="Groupwork_files/figure-html/scatter_with_groups-output-3.png" id="scatter_with_groups-3" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="Groupwork_files/figure-html/scatter_with_groups-output-4.png" id="scatter_with_groups-4" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="without-panel-regressions" class="level3">
<h3 class="anchored" data-anchor-id="without-panel-regressions">without panel regressions</h3>
<div id="scatter_no_groups" class="cell" data-execution_count="22">
<details class="code-fold">
<summary>Show code</summary>
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>Quick_scatter(PE, MKT, <span class="st">"PE ratio"</span>, <span class="st">"Market cap"</span>)</span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>Quick_scatter(EPS, MKT, <span class="st">"Earnings per share"</span>, <span class="st">"Market cap"</span>)</span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a>Quick_scatter(EPS, PE, <span class="st">"Earnings per share"</span>, <span class="st">"PE ratio"</span>)</span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a>Quick_scatter(ROE, ROA, <span class="st">"Returns on Equity"</span>, <span class="st">"Returns on Assets"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="Groupwork_files/figure-html/scatter_no_groups-output-1.png" id="scatter_no_groups-1" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="Groupwork_files/figure-html/scatter_no_groups-output-2.png" id="scatter_no_groups-2" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="Groupwork_files/figure-html/scatter_no_groups-output-3.png" id="scatter_no_groups-3" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="Groupwork_files/figure-html/scatter_no_groups-output-4.png" id="scatter_no_groups-4" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="timeseries" class="cell" data-execution_count="23">
<details class="code-fold">
<summary>Show code</summary>
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> basic_plot(data, NAME):</span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>    fig, ax <span class="op">=</span> plt.subplots(figsize<span class="op">=</span>(<span class="dv">12</span>, <span class="dv">6</span>))</span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Plot all columns (companies) against the index (quarters)</span></span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a>    <span class="co"># This is much simpler than the bar chart, as Matplotlib handles the</span></span>
<span id="cb30-6"><a href="#cb30-6" aria-hidden="true" tabindex="-1"></a>    <span class="co"># X-axis scaling automatically for line plots on an index.</span></span>
<span id="cb30-7"><a href="#cb30-7" aria-hidden="true" tabindex="-1"></a>    data.plot(kind<span class="op">=</span><span class="st">'line'</span>, ax<span class="op">=</span>ax)</span>
<span id="cb30-8"><a href="#cb30-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-9"><a href="#cb30-9" aria-hidden="true" tabindex="-1"></a>    <span class="co"># --- 3. CUSTOMIZING THE CHART ---</span></span>
<span id="cb30-10"><a href="#cb30-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-11"><a href="#cb30-11" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Add titles and labels</span></span>
<span id="cb30-12"><a href="#cb30-12" aria-hidden="true" tabindex="-1"></a>    ax.set_xlabel(<span class="st">"Quarter"</span>, fontsize<span class="op">=</span><span class="dv">12</span>)</span>
<span id="cb30-13"><a href="#cb30-13" aria-hidden="true" tabindex="-1"></a>    ax.set_ylabel(NAME.upper(), fontsize<span class="op">=</span><span class="dv">12</span>)</span>
<span id="cb30-14"><a href="#cb30-14" aria-hidden="true" tabindex="-1"></a>    ax.set_title(<span class="ss">f"</span><span class="sc">{</span>NAME<span class="sc">.</span>capitalize()<span class="sc">}</span><span class="ss"> Trend of 10 Companies Across 4 Quarters"</span>,</span>
<span id="cb30-15"><a href="#cb30-15" aria-hidden="true" tabindex="-1"></a>        fontsize<span class="op">=</span><span class="dv">14</span>,</span>
<span id="cb30-16"><a href="#cb30-16" aria-hidden="true" tabindex="-1"></a>        fontweight<span class="op">=</span><span class="st">'bold'</span></span>
<span id="cb30-17"><a href="#cb30-17" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb30-18"><a href="#cb30-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-19"><a href="#cb30-19" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Customize the legend: place it outside the plot area</span></span>
<span id="cb30-20"><a href="#cb30-20" aria-hidden="true" tabindex="-1"></a>    ax.legend(</span>
<span id="cb30-21"><a href="#cb30-21" aria-hidden="true" tabindex="-1"></a>        title<span class="op">=</span><span class="st">"Companies"</span>,</span>
<span id="cb30-22"><a href="#cb30-22" aria-hidden="true" tabindex="-1"></a>        bbox_to_anchor<span class="op">=</span>(<span class="fl">1.05</span>, <span class="fl">0.5</span>),</span>
<span id="cb30-23"><a href="#cb30-23" aria-hidden="true" tabindex="-1"></a>        loc<span class="op">=</span><span class="st">'center left'</span>,</span>
<span id="cb30-24"><a href="#cb30-24" aria-hidden="true" tabindex="-1"></a>        borderaxespad<span class="op">=</span><span class="dv">0</span>,</span>
<span id="cb30-25"><a href="#cb30-25" aria-hidden="true" tabindex="-1"></a>        frameon<span class="op">=</span><span class="va">False</span></span>
<span id="cb30-26"><a href="#cb30-26" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb30-27"><a href="#cb30-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-28"><a href="#cb30-28" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Ensure only the quarter labels are shown on the X-axis</span></span>
<span id="cb30-29"><a href="#cb30-29" aria-hidden="true" tabindex="-1"></a>    ax.set_xticks(<span class="bu">range</span>(<span class="dv">4</span>))</span>
<span id="cb30-30"><a href="#cb30-30" aria-hidden="true" tabindex="-1"></a>    ax.set_xticklabels(quarters)</span>
<span id="cb30-31"><a href="#cb30-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-32"><a href="#cb30-32" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Add a grid for better readability</span></span>
<span id="cb30-33"><a href="#cb30-33" aria-hidden="true" tabindex="-1"></a>    ax.grid(axis<span class="op">=</span><span class="st">'both'</span>, linestyle<span class="op">=</span><span class="st">'-'</span>, alpha<span class="op">=</span><span class="fl">0.6</span>)</span>
<span id="cb30-34"><a href="#cb30-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-35"><a href="#cb30-35" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Display the plot</span></span>
<span id="cb30-36"><a href="#cb30-36" aria-hidden="true" tabindex="-1"></a>    plt.tight_layout()</span>
<span id="cb30-37"><a href="#cb30-37" aria-hidden="true" tabindex="-1"></a>    plt.show()</span>
<span id="cb30-38"><a href="#cb30-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-39"><a href="#cb30-39" aria-hidden="true" tabindex="-1"></a>basic_plot(PE, <span class="st">"P/E ratio"</span>)</span>
<span id="cb30-40"><a href="#cb30-40" aria-hidden="true" tabindex="-1"></a>basic_plot(MKT, <span class="st">"market capitalisation"</span>)</span>
<span id="cb30-41"><a href="#cb30-41" aria-hidden="true" tabindex="-1"></a>basic_plot(EPS, <span class="st">"Earnings per share"</span>)</span>
<span id="cb30-42"><a href="#cb30-42" aria-hidden="true" tabindex="-1"></a><span class="co"># basic_plot(ROA, "return on assets")</span></span>
<span id="cb30-43"><a href="#cb30-43" aria-hidden="true" tabindex="-1"></a><span class="co"># basic_plot(ROE, "return on equity")</span></span>
<span id="cb30-44"><a href="#cb30-44" aria-hidden="true" tabindex="-1"></a><span class="co"># basic_plot(ESG, "Overall esg score")</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="Groupwork_files/figure-html/timeseries-output-1.png" id="timeseries-1" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="Groupwork_files/figure-html/timeseries-output-2.png" id="timeseries-2" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="Groupwork_files/figure-html/timeseries-output-3.png" id="timeseries-3" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="clustered_bar_chart" class="cell" data-execution_count="24">
<details class="code-fold">
<summary>Show code</summary>
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> clustered_bar_chart(df, name):</span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>    quarters <span class="op">=</span> [<span class="st">"Q4 2024"</span>, <span class="st">"Q1 2025"</span>, <span class="st">"Q2 2025"</span>, <span class="st">"Q3 2025"</span>]</span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a>    plot_df <span class="op">=</span> df.transpose().iloc[<span class="op">-</span><span class="dv">10</span>:]</span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a>    plot_df.columns <span class="op">=</span> quarters</span>
<span id="cb31-5"><a href="#cb31-5" aria-hidden="true" tabindex="-1"></a>    companies <span class="op">=</span> plot_df.index.tolist()</span>
<span id="cb31-6"><a href="#cb31-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-7"><a href="#cb31-7" aria-hidden="true" tabindex="-1"></a>    x <span class="op">=</span> np.arange(<span class="bu">len</span>(quarters))  <span class="co"># 4 quarter positions</span></span>
<span id="cb31-8"><a href="#cb31-8" aria-hidden="true" tabindex="-1"></a>    width <span class="op">=</span> <span class="fl">0.09</span>                  <span class="co"># small width because 10 companies inside each cluster</span></span>
<span id="cb31-9"><a href="#cb31-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-10"><a href="#cb31-10" aria-hidden="true" tabindex="-1"></a>    plt.figure(figsize<span class="op">=</span>(<span class="dv">14</span>, <span class="dv">7</span>))</span>
<span id="cb31-11"><a href="#cb31-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-12"><a href="#cb31-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i, company <span class="kw">in</span> <span class="bu">enumerate</span>(companies):</span>
<span id="cb31-13"><a href="#cb31-13" aria-hidden="true" tabindex="-1"></a>        plt.bar(</span>
<span id="cb31-14"><a href="#cb31-14" aria-hidden="true" tabindex="-1"></a>            x <span class="op">+</span> i<span class="op">*</span>width,                         <span class="co"># shift inside each quarter cluster</span></span>
<span id="cb31-15"><a href="#cb31-15" aria-hidden="true" tabindex="-1"></a>            plot_df.loc[company, quarters],           <span class="co"># values for that company</span></span>
<span id="cb31-16"><a href="#cb31-16" aria-hidden="true" tabindex="-1"></a>            width,</span>
<span id="cb31-17"><a href="#cb31-17" aria-hidden="true" tabindex="-1"></a>            label<span class="op">=</span>company,     <span class="co"># show legend only once</span></span>
<span id="cb31-18"><a href="#cb31-18" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb31-19"><a href="#cb31-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-20"><a href="#cb31-20" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Fix x-axis tick positions (center the cluster labels)</span></span>
<span id="cb31-21"><a href="#cb31-21" aria-hidden="true" tabindex="-1"></a>    plt.xticks(x <span class="op">+</span> width<span class="op">*</span><span class="bu">len</span>(companies)<span class="op">/</span><span class="dv">2</span>, quarters)</span>
<span id="cb31-22"><a href="#cb31-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-23"><a href="#cb31-23" aria-hidden="true" tabindex="-1"></a>    plt.xlabel(<span class="st">"Quarter"</span>)</span>
<span id="cb31-24"><a href="#cb31-24" aria-hidden="true" tabindex="-1"></a>    plt.ylabel(<span class="st">"Value"</span>)</span>
<span id="cb31-25"><a href="#cb31-25" aria-hidden="true" tabindex="-1"></a>    plt.title(<span class="ss">f"Clustered Bar Chart of </span><span class="sc">{</span>name<span class="sc">}</span><span class="ss"> by Quarter"</span>)</span>
<span id="cb31-26"><a href="#cb31-26" aria-hidden="true" tabindex="-1"></a>    plt.legend(title<span class="op">=</span><span class="st">"Company"</span>, loc<span class="op">=</span><span class="st">'center left'</span>,bbox_to_anchor<span class="op">=</span>(<span class="fl">1.02</span>, <span class="fl">0.5</span>), ncol<span class="op">=</span><span class="dv">1</span>, frameon<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb31-27"><a href="#cb31-27" aria-hidden="true" tabindex="-1"></a>    plt.tight_layout()</span>
<span id="cb31-28"><a href="#cb31-28" aria-hidden="true" tabindex="-1"></a>    plt.show()</span>
<span id="cb31-29"><a href="#cb31-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-30"><a href="#cb31-30" aria-hidden="true" tabindex="-1"></a>clustered_bar_chart(MKT, <span class="st">"Market Capitalisation"</span>)</span>
<span id="cb31-31"><a href="#cb31-31" aria-hidden="true" tabindex="-1"></a>clustered_bar_chart(EPS, <span class="st">"Earnings Per Share"</span>)</span>
<span id="cb31-32"><a href="#cb31-32" aria-hidden="true" tabindex="-1"></a>clustered_bar_chart(PE, <span class="st">"P/E Ratio"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="Groupwork_files/figure-html/clustered_bar_chart-output-1.png" id="clustered_bar_chart-1" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="Groupwork_files/figure-html/clustered_bar_chart-output-2.png" id="clustered_bar_chart-2" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="Groupwork_files/figure-html/clustered_bar_chart-output-3.png" id="clustered_bar_chart-3" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="stacked_bar_chart" class="cell" data-execution_count="25">
<details class="code-fold">
<summary>Show code</summary>
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> stacked_bar_chart(df, name):</span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a>    quarters <span class="op">=</span> [<span class="st">"Q4 2024"</span>, <span class="st">"Q1 2025"</span>, <span class="st">"Q2 2025"</span>, <span class="st">"Q3 2025"</span>]</span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a>    plot_df <span class="op">=</span> df.transpose().iloc[<span class="op">-</span><span class="dv">10</span>:]</span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a>    plot_df.columns <span class="op">=</span> quarters</span>
<span id="cb32-5"><a href="#cb32-5" aria-hidden="true" tabindex="-1"></a>    companies <span class="op">=</span> plot_df.index.tolist()</span>
<span id="cb32-6"><a href="#cb32-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-7"><a href="#cb32-7" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Convert all values to float</span></span>
<span id="cb32-8"><a href="#cb32-8" aria-hidden="true" tabindex="-1"></a>    plot_df <span class="op">=</span> plot_df.<span class="bu">apply</span>(pd.to_numeric, errors<span class="op">=</span><span class="st">"coerce"</span>)</span>
<span id="cb32-9"><a href="#cb32-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-10"><a href="#cb32-10" aria-hidden="true" tabindex="-1"></a>    x <span class="op">=</span> np.arange(<span class="bu">len</span>(quarters))</span>
<span id="cb32-11"><a href="#cb32-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-12"><a href="#cb32-12" aria-hidden="true" tabindex="-1"></a>    plt.figure(figsize<span class="op">=</span>(<span class="dv">14</span>,<span class="dv">7</span>))</span>
<span id="cb32-13"><a href="#cb32-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-14"><a href="#cb32-14" aria-hidden="true" tabindex="-1"></a>    bottom <span class="op">=</span> np.zeros(<span class="bu">len</span>(quarters), dtype<span class="op">=</span><span class="bu">float</span>)</span>
<span id="cb32-15"><a href="#cb32-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-16"><a href="#cb32-16" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> company <span class="kw">in</span> companies:</span>
<span id="cb32-17"><a href="#cb32-17" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb32-18"><a href="#cb32-18" aria-hidden="true" tabindex="-1"></a>        values <span class="op">=</span> plot_df.loc[company, quarters].values.astype(<span class="bu">float</span>)</span>
<span id="cb32-19"><a href="#cb32-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-20"><a href="#cb32-20" aria-hidden="true" tabindex="-1"></a>        plt.bar(</span>
<span id="cb32-21"><a href="#cb32-21" aria-hidden="true" tabindex="-1"></a>            x,</span>
<span id="cb32-22"><a href="#cb32-22" aria-hidden="true" tabindex="-1"></a>            values,</span>
<span id="cb32-23"><a href="#cb32-23" aria-hidden="true" tabindex="-1"></a>            bottom<span class="op">=</span>bottom,</span>
<span id="cb32-24"><a href="#cb32-24" aria-hidden="true" tabindex="-1"></a>            label<span class="op">=</span>company</span>
<span id="cb32-25"><a href="#cb32-25" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb32-26"><a href="#cb32-26" aria-hidden="true" tabindex="-1"></a>        bottom <span class="op">+=</span> values  <span class="co"># numeric safe</span></span>
<span id="cb32-27"><a href="#cb32-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-28"><a href="#cb32-28" aria-hidden="true" tabindex="-1"></a>    plt.xticks(x, quarters)</span>
<span id="cb32-29"><a href="#cb32-29" aria-hidden="true" tabindex="-1"></a>    plt.xlabel(<span class="st">"Quarter"</span>)</span>
<span id="cb32-30"><a href="#cb32-30" aria-hidden="true" tabindex="-1"></a>    plt.ylabel(<span class="ss">f"Total Value of </span><span class="sc">{</span>name<span class="sc">}</span><span class="ss"> (Stacked)"</span>)</span>
<span id="cb32-31"><a href="#cb32-31" aria-hidden="true" tabindex="-1"></a>    plt.title(<span class="ss">f"Stacked Bar Chart of </span><span class="sc">{</span>name<span class="sc">}</span><span class="ss"> (per Quarter)"</span>)</span>
<span id="cb32-32"><a href="#cb32-32" aria-hidden="true" tabindex="-1"></a>    plt.legend(title<span class="op">=</span><span class="st">"Company"</span>, loc<span class="op">=</span><span class="st">'center left'</span>, bbox_to_anchor<span class="op">=</span>(<span class="fl">1.02</span>, <span class="fl">0.5</span>), frameon<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb32-33"><a href="#cb32-33" aria-hidden="true" tabindex="-1"></a>    plt.tight_layout()</span>
<span id="cb32-34"><a href="#cb32-34" aria-hidden="true" tabindex="-1"></a>    plt.show()</span>
<span id="cb32-35"><a href="#cb32-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-36"><a href="#cb32-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-37"><a href="#cb32-37" aria-hidden="true" tabindex="-1"></a>stacked_bar_chart(MKT, <span class="st">"Market Capitalisation"</span>)</span>
<span id="cb32-38"><a href="#cb32-38" aria-hidden="true" tabindex="-1"></a>stacked_bar_chart(PE, <span class="st">"P/E Ratio"</span>)</span>
<span id="cb32-39"><a href="#cb32-39" aria-hidden="true" tabindex="-1"></a>stacked_bar_chart(EPS, <span class="st">"Earnings Per Share"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="Groupwork_files/figure-html/stacked_bar_chart-output-1.png" id="stacked_bar_chart-1" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="Groupwork_files/figure-html/stacked_bar_chart-output-2.png" id="stacked_bar_chart-2" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="Groupwork_files/figure-html/stacked_bar_chart-output-3.png" id="stacked_bar_chart-3" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="share_stacked_bar_chart" class="cell" data-execution_count="26">
<details class="code-fold">
<summary>Show code</summary>
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> percentage_stacked_bar_chart(df, name):</span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>    quarters <span class="op">=</span> [<span class="st">"Q4 2024"</span>, <span class="st">"Q1 2025"</span>, <span class="st">"Q2 2025"</span>, <span class="st">"Q3 2025"</span>]</span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a>    plot_df <span class="op">=</span> df.transpose().iloc[<span class="op">-</span><span class="dv">10</span>:]</span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a>    plot_df.columns <span class="op">=</span> quarters</span>
<span id="cb33-5"><a href="#cb33-5" aria-hidden="true" tabindex="-1"></a>    companies <span class="op">=</span> plot_df.index.tolist()</span>
<span id="cb33-6"><a href="#cb33-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-7"><a href="#cb33-7" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Convert to numeric</span></span>
<span id="cb33-8"><a href="#cb33-8" aria-hidden="true" tabindex="-1"></a>    plot_df <span class="op">=</span> plot_df.<span class="bu">apply</span>(pd.to_numeric, errors<span class="op">=</span><span class="st">"coerce"</span>)</span>
<span id="cb33-9"><a href="#cb33-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-10"><a href="#cb33-10" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Normalize so each column sums to 100</span></span>
<span id="cb33-11"><a href="#cb33-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-12"><a href="#cb33-12" aria-hidden="true" tabindex="-1"></a>    df_pct <span class="op">=</span> plot_df[quarters].div(plot_df[quarters].<span class="bu">sum</span>(axis<span class="op">=</span><span class="dv">0</span>), axis<span class="op">=</span><span class="dv">1</span>) <span class="op">*</span> <span class="dv">100</span></span>
<span id="cb33-13"><a href="#cb33-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-14"><a href="#cb33-14" aria-hidden="true" tabindex="-1"></a>    x <span class="op">=</span> np.arange(<span class="bu">len</span>(quarters))</span>
<span id="cb33-15"><a href="#cb33-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-16"><a href="#cb33-16" aria-hidden="true" tabindex="-1"></a>    plt.figure(figsize<span class="op">=</span>(<span class="dv">14</span>,<span class="dv">7</span>))</span>
<span id="cb33-17"><a href="#cb33-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-18"><a href="#cb33-18" aria-hidden="true" tabindex="-1"></a>    bottom <span class="op">=</span> np.zeros(<span class="bu">len</span>(quarters))</span>
<span id="cb33-19"><a href="#cb33-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-20"><a href="#cb33-20" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> company <span class="kw">in</span> companies:</span>
<span id="cb33-21"><a href="#cb33-21" aria-hidden="true" tabindex="-1"></a>        values <span class="op">=</span> df_pct.loc[company, quarters].values.astype(<span class="bu">float</span>)</span>
<span id="cb33-22"><a href="#cb33-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-23"><a href="#cb33-23" aria-hidden="true" tabindex="-1"></a>        plt.bar(</span>
<span id="cb33-24"><a href="#cb33-24" aria-hidden="true" tabindex="-1"></a>            x,</span>
<span id="cb33-25"><a href="#cb33-25" aria-hidden="true" tabindex="-1"></a>            values,</span>
<span id="cb33-26"><a href="#cb33-26" aria-hidden="true" tabindex="-1"></a>            bottom<span class="op">=</span>bottom,</span>
<span id="cb33-27"><a href="#cb33-27" aria-hidden="true" tabindex="-1"></a>            label<span class="op">=</span>company</span>
<span id="cb33-28"><a href="#cb33-28" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb33-29"><a href="#cb33-29" aria-hidden="true" tabindex="-1"></a>        bottom <span class="op">+=</span> values</span>
<span id="cb33-30"><a href="#cb33-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-31"><a href="#cb33-31" aria-hidden="true" tabindex="-1"></a>    plt.xticks(x, quarters)</span>
<span id="cb33-32"><a href="#cb33-32" aria-hidden="true" tabindex="-1"></a>    plt.xlabel(<span class="st">"Quarter"</span>)</span>
<span id="cb33-33"><a href="#cb33-33" aria-hidden="true" tabindex="-1"></a>    plt.ylabel(<span class="st">"Percentage Share (%)"</span>)</span>
<span id="cb33-34"><a href="#cb33-34" aria-hidden="true" tabindex="-1"></a>    plt.title(<span class="ss">f"Percentage Stacked Bar Chart of </span><span class="sc">{</span>name<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb33-35"><a href="#cb33-35" aria-hidden="true" tabindex="-1"></a>    plt.legend(title<span class="op">=</span><span class="st">"Company"</span>, loc<span class="op">=</span><span class="st">'center left'</span>, bbox_to_anchor<span class="op">=</span>(<span class="fl">1.02</span>, <span class="fl">0.5</span>), ncol<span class="op">=</span><span class="dv">1</span>, frameon<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb33-36"><a href="#cb33-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-37"><a href="#cb33-37" aria-hidden="true" tabindex="-1"></a>    plt.ylim(<span class="dv">0</span>, <span class="dv">100</span>)</span>
<span id="cb33-38"><a href="#cb33-38" aria-hidden="true" tabindex="-1"></a>    plt.tight_layout()</span>
<span id="cb33-39"><a href="#cb33-39" aria-hidden="true" tabindex="-1"></a>    plt.show()</span>
<span id="cb33-40"><a href="#cb33-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-41"><a href="#cb33-41" aria-hidden="true" tabindex="-1"></a>percentage_stacked_bar_chart(MKT, <span class="st">"Market Capitalisation"</span>)</span>
<span id="cb33-42"><a href="#cb33-42" aria-hidden="true" tabindex="-1"></a>percentage_stacked_bar_chart(EPS, <span class="st">"Earnings Per Share"</span>)</span>
<span id="cb33-43"><a href="#cb33-43" aria-hidden="true" tabindex="-1"></a>percentage_stacked_bar_chart(PE, <span class="st">"P/E Ratio"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="Groupwork_files/figure-html/share_stacked_bar_chart-output-1.png" id="share_stacked_bar_chart-1" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="Groupwork_files/figure-html/share_stacked_bar_chart-output-2.png" id="share_stacked_bar_chart-2" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="Groupwork_files/figure-html/share_stacked_bar_chart-output-3.png" id="share_stacked_bar_chart-3" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="esg" class="level2">
<h2 class="anchored" data-anchor-id="esg">ESG</h2>
<div id="scatter_fundamentals_esg" class="cell" data-execution_count="27">
<details class="code-fold">
<summary>Show code</summary>
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a>MKT2 <span class="op">=</span> MKT.iloc[<span class="dv">3</span>:,:]</span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a>PE2 <span class="op">=</span> PE.iloc[<span class="dv">3</span>:,:]</span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a>EPS2 <span class="op">=</span> EPS.iloc[<span class="dv">3</span>:,:]</span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-5"><a href="#cb34-5" aria-hidden="true" tabindex="-1"></a>Quick_scatter(ROE, ESG, <span class="st">"Returns on Equity"</span>, <span class="st">"ESG score"</span>)</span>
<span id="cb34-6"><a href="#cb34-6" aria-hidden="true" tabindex="-1"></a>Quick_scatter(ROA, ESG, <span class="st">"Returns on Assets"</span>, <span class="st">"ESG score"</span>)</span>
<span id="cb34-7"><a href="#cb34-7" aria-hidden="true" tabindex="-1"></a>Quick_scatter(MKT2, ESG, <span class="st">"Market Capitalisation"</span>, <span class="st">"ESG score"</span>)</span>
<span id="cb34-8"><a href="#cb34-8" aria-hidden="true" tabindex="-1"></a>Quick_scatter(PE2, ESG, <span class="st">"Price Earnings"</span>, <span class="st">"ESG score"</span>)</span>
<span id="cb34-9"><a href="#cb34-9" aria-hidden="true" tabindex="-1"></a>Quick_scatter(EPS2, ESG, <span class="st">"Earnings per Share"</span>, <span class="st">"ESG score"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="Groupwork_files/figure-html/scatter_fundamentals_esg-output-1.png" id="scatter_fundamentals_esg-1" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="Groupwork_files/figure-html/scatter_fundamentals_esg-output-2.png" id="scatter_fundamentals_esg-2" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="Groupwork_files/figure-html/scatter_fundamentals_esg-output-3.png" id="scatter_fundamentals_esg-3" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="Groupwork_files/figure-html/scatter_fundamentals_esg-output-4.png" id="scatter_fundamentals_esg-4" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="Groupwork_files/figure-html/scatter_fundamentals_esg-output-5.png" id="scatter_fundamentals_esg-5" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="scatter_fundamentals_esg_groups" class="cell" data-execution_count="28">
<details class="code-fold">
<summary>Show code</summary>
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a>Quick_scatter(ROE, ESG, <span class="st">"Returns on Equity"</span>, <span class="st">"ESG score"</span>, panelreg <span class="op">=</span> <span class="va">True</span>)</span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a>Quick_scatter(ROA, ESG, <span class="st">"Returns on Assets"</span>, <span class="st">"ESG score"</span>, panelreg <span class="op">=</span> <span class="va">True</span>)</span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a>Quick_scatter(MKT2, ESG, <span class="st">"Market Capitalisation"</span>, <span class="st">"ESG score"</span>, panelreg <span class="op">=</span> <span class="va">True</span>)</span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a>Quick_scatter(PE2, ESG, <span class="st">"Price Earnings"</span>, <span class="st">"ESG score"</span>, panelreg <span class="op">=</span> <span class="va">True</span>)</span>
<span id="cb35-5"><a href="#cb35-5" aria-hidden="true" tabindex="-1"></a>Quick_scatter(EPS2, ESG, <span class="st">"Earnings per Share"</span>, <span class="st">"ESG score"</span>, panelreg <span class="op">=</span> <span class="va">True</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="Groupwork_files/figure-html/scatter_fundamentals_esg_groups-output-1.png" id="scatter_fundamentals_esg_groups-1" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="Groupwork_files/figure-html/scatter_fundamentals_esg_groups-output-2.png" id="scatter_fundamentals_esg_groups-2" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="Groupwork_files/figure-html/scatter_fundamentals_esg_groups-output-3.png" id="scatter_fundamentals_esg_groups-3" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="Groupwork_files/figure-html/scatter_fundamentals_esg_groups-output-4.png" id="scatter_fundamentals_esg_groups-4" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="Groupwork_files/figure-html/scatter_fundamentals_esg_groups-output-5.png" id="scatter_fundamentals_esg_groups-5" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="scatter_fundamentals_roa" class="cell" data-execution_count="29">
<details class="code-fold">
<summary>Show code</summary>
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a>Quick_scatter(ROA, EPS2, <span class="st">"ROA"</span>, <span class="st">"EPS"</span>, panelreg <span class="op">=</span> <span class="va">True</span>)</span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a>Quick_scatter(ROA, MKT2, <span class="st">"ROA"</span>, <span class="st">"MKT"</span>, panelreg <span class="op">=</span> <span class="va">True</span>)</span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a>Quick_scatter(ROA, PE2,  <span class="st">"ROA"</span>, <span class="st">"PE"</span>, panelreg <span class="op">=</span><span class="va">True</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="Groupwork_files/figure-html/scatter_fundamentals_roa-output-1.png" id="scatter_fundamentals_roa-1" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="Groupwork_files/figure-html/scatter_fundamentals_roa-output-2.png" id="scatter_fundamentals_roa-2" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="Groupwork_files/figure-html/scatter_fundamentals_roa-output-3.png" id="scatter_fundamentals_roa-3" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="scatter_fundamentals_roe" class="cell" data-execution_count="30">
<details class="code-fold">
<summary>Show code</summary>
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a>Quick_scatter(ROE, EPS2, <span class="st">"ROE"</span>, <span class="st">"EPS"</span>, panelreg <span class="op">=</span> <span class="va">True</span>)</span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a>Quick_scatter(ROE, MKT2, <span class="st">"ROE"</span>, <span class="st">"MKT"</span>, panelreg <span class="op">=</span> <span class="va">True</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="Groupwork_files/figure-html/scatter_fundamentals_roe-output-1.png" id="scatter_fundamentals_roe-1" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="Groupwork_files/figure-html/scatter_fundamentals_roe-output-2.png" id="scatter_fundamentals_roe-2" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="b09661ea" class="cell" data-execution_count="31">
<details class="code-fold">
<summary>Show code</summary>
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a>Quick_scatter(ROE, PE2,  <span class="st">"ROE"</span>, <span class="st">"PE"</span>, panelreg <span class="op">=</span> <span class="va">False</span>, groupreg <span class="op">=</span> <span class="va">False</span>)</span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Horizontal and vertical thresholds</span></span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a>x_thresh <span class="op">=</span> <span class="dv">7</span>    <span class="co"># ROE</span></span>
<span id="cb38-4"><a href="#cb38-4" aria-hidden="true" tabindex="-1"></a>y_thresh <span class="op">=</span> <span class="dv">30</span>   <span class="co"># PE</span></span>
<span id="cb38-5"><a href="#cb38-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-6"><a href="#cb38-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Shade region: x &lt; 10 (vertical span), y &gt; 30 (horizontal span)</span></span>
<span id="cb38-7"><a href="#cb38-7" aria-hidden="true" tabindex="-1"></a>plt.axvspan(xmin<span class="op">=</span>plt.xlim()[<span class="dv">0</span>], xmax<span class="op">=</span>x_thresh, ymin<span class="op">=</span>y_thresh <span class="op">/</span> plt.ylim()[<span class="dv">1</span>], ymax<span class="op">=</span><span class="dv">1</span>,</span>
<span id="cb38-8"><a href="#cb38-8" aria-hidden="true" tabindex="-1"></a>color<span class="op">=</span><span class="st">'red'</span>, alpha<span class="op">=</span><span class="fl">0.15</span>, label<span class="op">=</span><span class="st">'Low ROE &amp; High PE Region'</span>)</span>
<span id="cb38-9"><a href="#cb38-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-10"><a href="#cb38-10" aria-hidden="true" tabindex="-1"></a>x_thresh <span class="op">=</span> <span class="dv">10</span>   <span class="co"># ROE</span></span>
<span id="cb38-11"><a href="#cb38-11" aria-hidden="true" tabindex="-1"></a>y_thresh <span class="op">=</span> <span class="dv">15</span>   <span class="co"># PE</span></span>
<span id="cb38-12"><a href="#cb38-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Shade region: x &lt; 10 (vertical span), y &gt; 30 (horizontal span)</span></span>
<span id="cb38-13"><a href="#cb38-13" aria-hidden="true" tabindex="-1"></a>plt.axvspan(xmin<span class="op">=</span>plt.xlim()[<span class="dv">0</span>], xmax<span class="op">=</span>x_thresh, ymin<span class="op">=</span>y_thresh <span class="op">/</span> plt.ylim()[<span class="dv">1</span>], ymax<span class="op">=</span><span class="dv">1</span>,</span>
<span id="cb38-14"><a href="#cb38-14" aria-hidden="true" tabindex="-1"></a>color<span class="op">=</span><span class="st">'red'</span>, alpha<span class="op">=</span><span class="fl">0.15</span>, label<span class="op">=</span><span class="st">'Low ROE &amp; High PE Region'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="Groupwork_files/figure-html/cell-32-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<section id="growth" class="level3">
<h3 class="anchored" data-anchor-id="growth">Growth</h3>
<div id="fundamentals_growth" class="cell" data-execution_count="32">
<details class="code-fold">
<summary>Show code</summary>
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a>basic_plot(EPS.iloc[:, <span class="dv">1</span>:].div(EPS.iloc[<span class="dv">0</span>, <span class="dv">1</span>:], axis<span class="op">=</span><span class="dv">1</span>), <span class="st">"Earnings per Share Growth"</span>)</span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a>basic_plot(MKT.iloc[:, <span class="dv">1</span>:].div(MKT.iloc[<span class="dv">0</span>, <span class="dv">1</span>:], axis<span class="op">=</span><span class="dv">1</span>), <span class="st">"Market Capitalisation Growth"</span>)</span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a>basic_plot(PE.iloc[:, <span class="dv">1</span>:].div(PE.iloc[<span class="dv">0</span>, <span class="dv">1</span>:], axis<span class="op">=</span><span class="dv">1</span>), <span class="st">"PE Growth"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="Groupwork_files/figure-html/fundamentals_growth-output-1.png" id="fundamentals_growth-1" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="Groupwork_files/figure-html/fundamentals_growth-output-2.png" id="fundamentals_growth-2" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="Groupwork_files/figure-html/fundamentals_growth-output-3.png" id="fundamentals_growth-3" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="simple_bar_chart" class="cell" data-execution_count="33">
<details class="code-fold">
<summary>Show code</summary>
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> simple_bar_chart(data, title, ylabel <span class="op">=</span> <span class="st">"Company"</span>):</span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a>    colors <span class="op">=</span> {</span>
<span id="cb40-4"><a href="#cb40-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">'CVX US Equity'</span>: <span class="st">'#1f77b4'</span>,</span>
<span id="cb40-5"><a href="#cb40-5" aria-hidden="true" tabindex="-1"></a>    <span class="st">'FSLR US Equity'</span>: <span class="st">'#ff7f0e'</span>,</span>
<span id="cb40-6"><a href="#cb40-6" aria-hidden="true" tabindex="-1"></a>    <span class="st">'ENI IM Equity'</span>: <span class="st">'#2ca02c'</span>,</span>
<span id="cb40-7"><a href="#cb40-7" aria-hidden="true" tabindex="-1"></a>    <span class="st">'XOM US Equity'</span>: <span class="st">'#d62728'</span>,</span>
<span id="cb40-8"><a href="#cb40-8" aria-hidden="true" tabindex="-1"></a>    <span class="st">'SHEL LN Equity'</span>: <span class="st">'#9467bd'</span>,</span>
<span id="cb40-9"><a href="#cb40-9" aria-hidden="true" tabindex="-1"></a>    <span class="st">'VWS DC Equity'</span>: <span class="st">'#8c564b'</span>,</span>
<span id="cb40-10"><a href="#cb40-10" aria-hidden="true" tabindex="-1"></a>    <span class="st">'EQNR NO Equity'</span>: <span class="st">'#e377c2'</span>,</span>
<span id="cb40-11"><a href="#cb40-11" aria-hidden="true" tabindex="-1"></a>    <span class="st">'TTE FP Equity'</span>: <span class="st">'#7f7f7f'</span>,</span>
<span id="cb40-12"><a href="#cb40-12" aria-hidden="true" tabindex="-1"></a>    <span class="st">'AMRC US Equity'</span>: <span class="st">'#bcbd22'</span>,</span>
<span id="cb40-13"><a href="#cb40-13" aria-hidden="true" tabindex="-1"></a>    <span class="st">'NEE US Equity'</span>: <span class="st">'#17becf'</span></span>
<span id="cb40-14"><a href="#cb40-14" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb40-15"><a href="#cb40-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-16"><a href="#cb40-16" aria-hidden="true" tabindex="-1"></a>    plot_data <span class="op">=</span> data.iloc[<span class="dv">0</span>, <span class="dv">1</span>:].sort_values(ascending<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb40-17"><a href="#cb40-17" aria-hidden="true" tabindex="-1"></a>    bar_colors <span class="op">=</span> [colors[ticker] <span class="cf">for</span> ticker <span class="kw">in</span> plot_data.index]</span>
<span id="cb40-18"><a href="#cb40-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-19"><a href="#cb40-19" aria-hidden="true" tabindex="-1"></a>    plt.figure(figsize<span class="op">=</span>(<span class="dv">10</span>, <span class="dv">6</span>))</span>
<span id="cb40-20"><a href="#cb40-20" aria-hidden="true" tabindex="-1"></a>    plot_data.plot(kind<span class="op">=</span><span class="st">'barh'</span>, color<span class="op">=</span>bar_colors, width<span class="op">=</span><span class="fl">0.9</span>)</span>
<span id="cb40-21"><a href="#cb40-21" aria-hidden="true" tabindex="-1"></a>    plt.xlabel(title, fontsize<span class="op">=</span><span class="dv">12</span>, fontweight<span class="op">=</span><span class="st">'bold'</span>)</span>
<span id="cb40-22"><a href="#cb40-22" aria-hidden="true" tabindex="-1"></a>    plt.ylabel(ylabel, fontsize<span class="op">=</span><span class="dv">12</span>, fontweight<span class="op">=</span><span class="st">'bold'</span>)</span>
<span id="cb40-23"><a href="#cb40-23" aria-hidden="true" tabindex="-1"></a>    plt.title(<span class="ss">f"</span><span class="sc">{</span>title<span class="sc">}</span><span class="ss"> Analysis"</span>, fontsize<span class="op">=</span><span class="dv">14</span>)</span>
<span id="cb40-24"><a href="#cb40-24" aria-hidden="true" tabindex="-1"></a>    plt.grid(axis<span class="op">=</span><span class="st">'y'</span>, alpha<span class="op">=</span><span class="fl">0.3</span>)</span>
<span id="cb40-25"><a href="#cb40-25" aria-hidden="true" tabindex="-1"></a>    plt.tight_layout()</span>
<span id="cb40-26"><a href="#cb40-26" aria-hidden="true" tabindex="-1"></a>    plt.show()</span>
<span id="cb40-27"><a href="#cb40-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-28"><a href="#cb40-28" aria-hidden="true" tabindex="-1"></a>simple_bar_chart(ROA, <span class="st">"Return on Assets (%)"</span>)</span>
<span id="cb40-29"><a href="#cb40-29" aria-hidden="true" tabindex="-1"></a>simple_bar_chart(ROE, <span class="st">"Return on Equity (%)"</span>)</span>
<span id="cb40-30"><a href="#cb40-30" aria-hidden="true" tabindex="-1"></a>simple_bar_chart(ESG, <span class="st">"ESG Scores"</span>)</span>
<span id="cb40-31"><a href="#cb40-31" aria-hidden="true" tabindex="-1"></a>DIFF <span class="op">=</span> (ROE.transpose().iloc[<span class="op">-</span><span class="dv">10</span>:] <span class="op">-</span> ROA.transpose().iloc[<span class="op">-</span><span class="dv">10</span>:])</span>
<span id="cb40-32"><a href="#cb40-32" aria-hidden="true" tabindex="-1"></a>simple_bar_chart(DIFF.transpose(), <span class="st">"ROE - ROA"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="Groupwork_files/figure-html/simple_bar_chart-output-1.png" id="simple_bar_chart-1" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="Groupwork_files/figure-html/simple_bar_chart-output-2.png" id="simple_bar_chart-2" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="Groupwork_files/figure-html/simple_bar_chart-output-3.png" id="simple_bar_chart-3" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="Groupwork_files/figure-html/simple_bar_chart-output-4.png" id="simple_bar_chart-4" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="cumulative_returns_esg_groups" class="cell" data-execution_count="34">
<details class="code-fold">
<summary>Show code</summary>
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a>MKTL <span class="op">=</span> MKT.iloc[<span class="dv">3</span>:,:]</span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a>MKTL[[<span class="st">'CVX US Equity'</span>, <span class="st">'XOM US Equity'</span>, <span class="st">'SHEL LN Equity'</span>]]</span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Compute group weights</span></span>
<span id="cb41-4"><a href="#cb41-4" aria-hidden="true" tabindex="-1"></a>GREEN_weights <span class="op">=</span> MKTL[[<span class="st">'VWS DC Equity'</span>, <span class="st">'FSLR US Equity'</span>, <span class="st">'AMRC US Equity'</span>]].div(</span>
<span id="cb41-5"><a href="#cb41-5" aria-hidden="true" tabindex="-1"></a>    MKTL[[<span class="st">'VWS DC Equity'</span>, <span class="st">'FSLR US Equity'</span>, <span class="st">'AMRC US Equity'</span>]].<span class="bu">sum</span>(axis<span class="op">=</span><span class="dv">1</span>), axis<span class="op">=</span><span class="dv">0</span></span>
<span id="cb41-6"><a href="#cb41-6" aria-hidden="true" tabindex="-1"></a>).iloc[<span class="dv">0</span>] </span>
<span id="cb41-7"><a href="#cb41-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-8"><a href="#cb41-8" aria-hidden="true" tabindex="-1"></a>TRANSITIONAL_weights <span class="op">=</span> MKTL[[<span class="st">'ENI IM Equity'</span>, <span class="st">'TTE FP Equity'</span>, <span class="st">'EQNR NO Equity'</span>, <span class="st">'NEE US Equity'</span>]].div(</span>
<span id="cb41-9"><a href="#cb41-9" aria-hidden="true" tabindex="-1"></a>    MKTL[[<span class="st">'ENI IM Equity'</span>, <span class="st">'TTE FP Equity'</span>, <span class="st">'EQNR NO Equity'</span>, <span class="st">'NEE US Equity'</span>]].<span class="bu">sum</span>(axis<span class="op">=</span><span class="dv">1</span>), axis<span class="op">=</span><span class="dv">0</span></span>
<span id="cb41-10"><a href="#cb41-10" aria-hidden="true" tabindex="-1"></a>).iloc[<span class="dv">0</span>] </span>
<span id="cb41-11"><a href="#cb41-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-12"><a href="#cb41-12" aria-hidden="true" tabindex="-1"></a>BROWN_weights <span class="op">=</span> MKTL[[<span class="st">'CVX US Equity'</span>, <span class="st">'XOM US Equity'</span>, <span class="st">'SHEL LN Equity'</span>]].div(</span>
<span id="cb41-13"><a href="#cb41-13" aria-hidden="true" tabindex="-1"></a>    MKTL[[<span class="st">'CVX US Equity'</span>, <span class="st">'XOM US Equity'</span>, <span class="st">'SHEL LN Equity'</span>]].<span class="bu">sum</span>(axis<span class="op">=</span><span class="dv">1</span>), axis<span class="op">=</span><span class="dv">0</span></span>
<span id="cb41-14"><a href="#cb41-14" aria-hidden="true" tabindex="-1"></a>).iloc[<span class="dv">0</span>] </span>
<span id="cb41-15"><a href="#cb41-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-16"><a href="#cb41-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-17"><a href="#cb41-17" aria-hidden="true" tabindex="-1"></a>GREEN_ret <span class="op">=</span> (returns[[<span class="st">'VWS DC Equity'</span>, <span class="st">'FSLR US Equity'</span>, <span class="st">'AMRC US Equity'</span>]] <span class="op">*</span> GREEN_weights).<span class="bu">sum</span>(axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb41-18"><a href="#cb41-18" aria-hidden="true" tabindex="-1"></a>TRANSITIONAL_ret <span class="op">=</span> (returns[[<span class="st">'ENI IM Equity'</span>, <span class="st">'TTE FP Equity'</span>, <span class="st">'EQNR NO Equity'</span>, <span class="st">'NEE US Equity'</span>]] <span class="op">*</span> TRANSITIONAL_weights).<span class="bu">sum</span>(axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb41-19"><a href="#cb41-19" aria-hidden="true" tabindex="-1"></a>BROWN_ret <span class="op">=</span> (returns[[<span class="st">'CVX US Equity'</span>, <span class="st">'XOM US Equity'</span>, <span class="st">'SHEL LN Equity'</span>]] <span class="op">*</span> BROWN_weights).<span class="bu">sum</span>(axis<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb41-20"><a href="#cb41-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-21"><a href="#cb41-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-22"><a href="#cb41-22" aria-hidden="true" tabindex="-1"></a>cum_GREEN_ret <span class="op">=</span> <span class="dv">100</span> <span class="op">*</span> (<span class="dv">1</span> <span class="op">+</span> GREEN_ret).cumprod()</span>
<span id="cb41-23"><a href="#cb41-23" aria-hidden="true" tabindex="-1"></a>cum_TRANSITIONAL_ret <span class="op">=</span> <span class="dv">100</span> <span class="op">*</span> (<span class="dv">1</span> <span class="op">+</span> TRANSITIONAL_ret).cumprod()</span>
<span id="cb41-24"><a href="#cb41-24" aria-hidden="true" tabindex="-1"></a>cum_BROWN_ret <span class="op">=</span> <span class="dv">100</span> <span class="op">*</span> (<span class="dv">1</span> <span class="op">+</span> BROWN_ret).cumprod()</span>
<span id="cb41-25"><a href="#cb41-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-26"><a href="#cb41-26" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">12</span>, <span class="dv">6</span>))</span>
<span id="cb41-27"><a href="#cb41-27" aria-hidden="true" tabindex="-1"></a>plt.plot(cum_GREEN_ret, label<span class="op">=</span><span class="st">'Aligned Companies'</span>, color<span class="op">=</span><span class="st">'green'</span>)</span>
<span id="cb41-28"><a href="#cb41-28" aria-hidden="true" tabindex="-1"></a>plt.plot(cum_TRANSITIONAL_ret, label<span class="op">=</span><span class="st">'Developing Companies'</span>, color<span class="op">=</span><span class="st">'gray'</span>)</span>
<span id="cb41-29"><a href="#cb41-29" aria-hidden="true" tabindex="-1"></a>plt.plot(cum_BROWN_ret, label<span class="op">=</span><span class="st">'Unprepared Companies'</span>, color<span class="op">=</span><span class="st">'brown'</span>)</span>
<span id="cb41-30"><a href="#cb41-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-31"><a href="#cb41-31" aria-hidden="true" tabindex="-1"></a>plt.grid(axis<span class="op">=</span><span class="st">'both'</span>, linestyle<span class="op">=</span><span class="st">'-'</span>, alpha<span class="op">=</span><span class="fl">0.6</span>)</span>
<span id="cb41-32"><a href="#cb41-32" aria-hidden="true" tabindex="-1"></a>plt.legend(title<span class="op">=</span><span class="st">"Company"</span>, loc<span class="op">=</span><span class="st">'center left'</span>, bbox_to_anchor<span class="op">=</span>(<span class="fl">1.02</span>, <span class="fl">0.5</span>), ncol<span class="op">=</span><span class="dv">1</span>, frameon<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb41-33"><a href="#cb41-33" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">"Market-Cap Weighted Cumulative Returns by ESG Category"</span>, fontsize<span class="op">=</span><span class="dv">16</span>)</span>
<span id="cb41-34"><a href="#cb41-34" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb41-35"><a href="#cb41-35" aria-hidden="true" tabindex="-1"></a>plt.show()</span>
<span id="cb41-36"><a href="#cb41-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-37"><a href="#cb41-37" aria-hidden="true" tabindex="-1"></a>GREEN <span class="op">=</span> returns[[<span class="st">'VWS DC Equity'</span>, <span class="st">'FSLR US Equity'</span>, <span class="st">"AMRC US Equity"</span>]].<span class="bu">sum</span>(axis<span class="op">=</span><span class="dv">1</span>) </span>
<span id="cb41-38"><a href="#cb41-38" aria-hidden="true" tabindex="-1"></a>TRANSITIONAL <span class="op">=</span> returns[[<span class="st">'ENI IM Equity'</span>, <span class="st">'TTE FP Equity'</span>, <span class="st">"EQNR NO Equity"</span>, <span class="st">"NEE US Equity"</span>]].<span class="bu">sum</span>(axis<span class="op">=</span><span class="dv">1</span>) </span>
<span id="cb41-39"><a href="#cb41-39" aria-hidden="true" tabindex="-1"></a>BROWN <span class="op">=</span> returns[[<span class="st">'CVX US Equity'</span>, <span class="st">'XOM US Equity'</span>, <span class="st">"SHEL LN Equity"</span>]].<span class="bu">sum</span>(axis<span class="op">=</span><span class="dv">1</span>) </span>
<span id="cb41-40"><a href="#cb41-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-41"><a href="#cb41-41" aria-hidden="true" tabindex="-1"></a>cum_GREEN_ret <span class="op">=</span> <span class="dv">100</span> <span class="op">*</span> (<span class="dv">1</span> <span class="op">+</span> GREEN).cumprod()</span>
<span id="cb41-42"><a href="#cb41-42" aria-hidden="true" tabindex="-1"></a>cum_TRANSITIONAL_ret <span class="op">=</span> <span class="dv">100</span> <span class="op">*</span> (<span class="dv">1</span> <span class="op">+</span> TRANSITIONAL).cumprod()</span>
<span id="cb41-43"><a href="#cb41-43" aria-hidden="true" tabindex="-1"></a>cum_BROWN_ret <span class="op">=</span> <span class="dv">100</span> <span class="op">*</span> (<span class="dv">1</span> <span class="op">+</span> BROWN).cumprod()</span>
<span id="cb41-44"><a href="#cb41-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-45"><a href="#cb41-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-46"><a href="#cb41-46" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">12</span>, <span class="dv">6</span>)) </span>
<span id="cb41-47"><a href="#cb41-47" aria-hidden="true" tabindex="-1"></a>plt.plot(cum_GREEN_ret, label<span class="op">=</span><span class="st">'Aligned Companies'</span>, color<span class="op">=</span><span class="st">'green'</span>) </span>
<span id="cb41-48"><a href="#cb41-48" aria-hidden="true" tabindex="-1"></a>plt.plot(cum_TRANSITIONAL_ret, label<span class="op">=</span><span class="st">'Developing Companies'</span>, color<span class="op">=</span><span class="st">'gray'</span>) </span>
<span id="cb41-49"><a href="#cb41-49" aria-hidden="true" tabindex="-1"></a>plt.plot(cum_BROWN_ret, label<span class="op">=</span><span class="st">'Unprepared Companies'</span>, color<span class="op">=</span><span class="st">'brown'</span>) </span>
<span id="cb41-50"><a href="#cb41-50" aria-hidden="true" tabindex="-1"></a>plt.grid(axis<span class="op">=</span><span class="st">'both'</span>, linestyle<span class="op">=</span><span class="st">'-'</span>, alpha<span class="op">=</span><span class="fl">0.6</span>) </span>
<span id="cb41-51"><a href="#cb41-51" aria-hidden="true" tabindex="-1"></a>plt.legend(title<span class="op">=</span><span class="st">"Company"</span>, loc<span class="op">=</span><span class="st">'center left'</span>, bbox_to_anchor<span class="op">=</span>(<span class="fl">1.02</span>, <span class="fl">0.5</span>), ncol<span class="op">=</span><span class="dv">1</span>, frameon<span class="op">=</span><span class="va">False</span>) </span>
<span id="cb41-52"><a href="#cb41-52" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">"Cumulative Returns by ESG Category Equally weighted"</span>, fontsize<span class="op">=</span><span class="dv">16</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="Groupwork_files/figure-html/cumulative_returns_esg_groups-output-1.png" id="cumulative_returns_esg_groups-1" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div id="cumulative_returns_esg_groups-2" class="cell-output cell-output-display" data-execution_count="34">
<pre><code>Text(0.5, 1.0, 'Cumulative Returns by ESG Category Equally weighted')</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="Groupwork_files/figure-html/cumulative_returns_esg_groups-output-3.png" id="cumulative_returns_esg_groups-3" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="049cca52" class="cell" data-execution_count="35">
<details class="code-fold">
<summary>Show code</summary>
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> Quick_scatter(Data1, Data2, label1, label2, ylog<span class="op">=</span><span class="va">False</span>, xlog<span class="op">=</span><span class="va">False</span>, panelreg <span class="op">=</span> <span class="va">False</span>, groupreg <span class="op">=</span> <span class="va">True</span>):</span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Collect all data for panel regression</span></span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a>    all_data1 <span class="op">=</span> []</span>
<span id="cb43-4"><a href="#cb43-4" aria-hidden="true" tabindex="-1"></a>    all_data2 <span class="op">=</span> []</span>
<span id="cb43-5"><a href="#cb43-5" aria-hidden="true" tabindex="-1"></a>    plt.figure(figsize<span class="op">=</span>(<span class="dv">8</span>, <span class="dv">6</span>))</span>
<span id="cb43-6"><a href="#cb43-6" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb43-7"><a href="#cb43-7" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> groupreg:</span>
<span id="cb43-8"><a href="#cb43-8" aria-hidden="true" tabindex="-1"></a>    <span class="co"># ---- classify companies ----</span></span>
<span id="cb43-9"><a href="#cb43-9" aria-hidden="true" tabindex="-1"></a>        green_status <span class="op">=</span> {</span>
<span id="cb43-10"><a href="#cb43-10" aria-hidden="true" tabindex="-1"></a>            <span class="st">"CVX US Equity"</span>: <span class="st">"no"</span>,</span>
<span id="cb43-11"><a href="#cb43-11" aria-hidden="true" tabindex="-1"></a>            <span class="st">"FSLR US Equity"</span>: <span class="st">"yes"</span>,</span>
<span id="cb43-12"><a href="#cb43-12" aria-hidden="true" tabindex="-1"></a>            <span class="st">"ENI IM Equity"</span>: <span class="st">"some"</span>,</span>
<span id="cb43-13"><a href="#cb43-13" aria-hidden="true" tabindex="-1"></a>            <span class="st">"XOM US Equity"</span>: <span class="st">"no"</span>,</span>
<span id="cb43-14"><a href="#cb43-14" aria-hidden="true" tabindex="-1"></a>            <span class="st">"SHEL LN Equity"</span>: <span class="st">"no"</span>,</span>
<span id="cb43-15"><a href="#cb43-15" aria-hidden="true" tabindex="-1"></a>            <span class="st">"VWS DC Equity"</span>: <span class="st">"yes"</span>,</span>
<span id="cb43-16"><a href="#cb43-16" aria-hidden="true" tabindex="-1"></a>            <span class="st">"EQNR NO Equity"</span>: <span class="st">"some"</span>,</span>
<span id="cb43-17"><a href="#cb43-17" aria-hidden="true" tabindex="-1"></a>            <span class="st">"TTE FP Equity"</span>: <span class="st">"some"</span>,</span>
<span id="cb43-18"><a href="#cb43-18" aria-hidden="true" tabindex="-1"></a>            <span class="st">"AMRC US Equity"</span>: <span class="st">"yes"</span>,</span>
<span id="cb43-19"><a href="#cb43-19" aria-hidden="true" tabindex="-1"></a>            <span class="st">"NEE US Equity"</span>: <span class="st">"yes"</span></span>
<span id="cb43-20"><a href="#cb43-20" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb43-21"><a href="#cb43-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-22"><a href="#cb43-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-23"><a href="#cb43-23" aria-hidden="true" tabindex="-1"></a>        <span class="co"># If you want: define green = yes only</span></span>
<span id="cb43-24"><a href="#cb43-24" aria-hidden="true" tabindex="-1"></a>        green_companies <span class="op">=</span> [c <span class="cf">for</span> c,s <span class="kw">in</span> green_status.items() <span class="cf">if</span> s <span class="op">==</span> <span class="st">"yes"</span>]</span>
<span id="cb43-25"><a href="#cb43-25" aria-hidden="true" tabindex="-1"></a>        non_green_companies <span class="op">=</span> [c <span class="cf">for</span> c,s <span class="kw">in</span> green_status.items() <span class="cf">if</span> s <span class="op">==</span> <span class="st">"no"</span>]</span>
<span id="cb43-26"><a href="#cb43-26" aria-hidden="true" tabindex="-1"></a>        some_companies <span class="op">=</span> [c <span class="cf">for</span> c,s <span class="kw">in</span> green_status.items() <span class="cf">if</span> s <span class="op">==</span> <span class="st">"some"</span>]  <span class="co"># optional</span></span>
<span id="cb43-27"><a href="#cb43-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-28"><a href="#cb43-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-29"><a href="#cb43-29" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Also prepare lists for green/non-green group regressions</span></span>
<span id="cb43-30"><a href="#cb43-30" aria-hidden="true" tabindex="-1"></a>        green_x <span class="op">=</span> []</span>
<span id="cb43-31"><a href="#cb43-31" aria-hidden="true" tabindex="-1"></a>        green_y <span class="op">=</span> []</span>
<span id="cb43-32"><a href="#cb43-32" aria-hidden="true" tabindex="-1"></a>        nongreen_x <span class="op">=</span> []</span>
<span id="cb43-33"><a href="#cb43-33" aria-hidden="true" tabindex="-1"></a>        nongreen_y <span class="op">=</span> []</span>
<span id="cb43-34"><a href="#cb43-34" aria-hidden="true" tabindex="-1"></a>        some_x <span class="op">=</span> []</span>
<span id="cb43-35"><a href="#cb43-35" aria-hidden="true" tabindex="-1"></a>        some_y <span class="op">=</span> []</span>
<span id="cb43-36"><a href="#cb43-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-37"><a href="#cb43-37" aria-hidden="true" tabindex="-1"></a>    <span class="co"># --- Plot scatter + company-level regressions ---</span></span>
<span id="cb43-38"><a href="#cb43-38" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> company <span class="kw">in</span> company_columns:</span>
<span id="cb43-39"><a href="#cb43-39" aria-hidden="true" tabindex="-1"></a>        Data1_series <span class="op">=</span> Data1[company]</span>
<span id="cb43-40"><a href="#cb43-40" aria-hidden="true" tabindex="-1"></a>        Data2_series <span class="op">=</span> Data2[company]</span>
<span id="cb43-41"><a href="#cb43-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-42"><a href="#cb43-42" aria-hidden="true" tabindex="-1"></a>        all_data1.append(Data1_series)</span>
<span id="cb43-43"><a href="#cb43-43" aria-hidden="true" tabindex="-1"></a>        all_data2.append(Data2_series)</span>
<span id="cb43-44"><a href="#cb43-44" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> groupreg:</span>
<span id="cb43-45"><a href="#cb43-45" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Add to correct group</span></span>
<span id="cb43-46"><a href="#cb43-46" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> company <span class="kw">in</span> green_companies:</span>
<span id="cb43-47"><a href="#cb43-47" aria-hidden="true" tabindex="-1"></a>                green_x.append(Data1_series)</span>
<span id="cb43-48"><a href="#cb43-48" aria-hidden="true" tabindex="-1"></a>                green_y.append(Data2_series)</span>
<span id="cb43-49"><a href="#cb43-49" aria-hidden="true" tabindex="-1"></a>            <span class="cf">elif</span> company <span class="kw">in</span> non_green_companies:</span>
<span id="cb43-50"><a href="#cb43-50" aria-hidden="true" tabindex="-1"></a>                nongreen_x.append(Data1_series)</span>
<span id="cb43-51"><a href="#cb43-51" aria-hidden="true" tabindex="-1"></a>                nongreen_y.append(Data2_series)</span>
<span id="cb43-52"><a href="#cb43-52" aria-hidden="true" tabindex="-1"></a>            <span class="cf">elif</span> company <span class="kw">in</span> some_companies:</span>
<span id="cb43-53"><a href="#cb43-53" aria-hidden="true" tabindex="-1"></a>                some_x.append(Data1_series)</span>
<span id="cb43-54"><a href="#cb43-54" aria-hidden="true" tabindex="-1"></a>                some_y.append(Data2_series)</span>
<span id="cb43-55"><a href="#cb43-55" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-56"><a href="#cb43-56" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Company scatter</span></span>
<span id="cb43-57"><a href="#cb43-57" aria-hidden="true" tabindex="-1"></a>        plt.scatter(Data1_series, Data2_series, label<span class="op">=</span>company)</span>
<span id="cb43-58"><a href="#cb43-58" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-59"><a href="#cb43-59" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Company individual regression</span></span>
<span id="cb43-60"><a href="#cb43-60" aria-hidden="true" tabindex="-1"></a>        <span class="co"># sns.regplot(</span></span>
<span id="cb43-61"><a href="#cb43-61" aria-hidden="true" tabindex="-1"></a>        <span class="co">#     x=Data1_series.values,</span></span>
<span id="cb43-62"><a href="#cb43-62" aria-hidden="true" tabindex="-1"></a>        <span class="co">#     y=Data2_series.values,</span></span>
<span id="cb43-63"><a href="#cb43-63" aria-hidden="true" tabindex="-1"></a>        <span class="co">#     scatter=False,</span></span>
<span id="cb43-64"><a href="#cb43-64" aria-hidden="true" tabindex="-1"></a>        <span class="co">#     ci=None,</span></span>
<span id="cb43-65"><a href="#cb43-65" aria-hidden="true" tabindex="-1"></a>        <span class="co">#     line_kws={'alpha': 0.6, 'linewidth': 1}</span></span>
<span id="cb43-66"><a href="#cb43-66" aria-hidden="true" tabindex="-1"></a>        <span class="co"># )</span></span>
<span id="cb43-67"><a href="#cb43-67" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-68"><a href="#cb43-68" aria-hidden="true" tabindex="-1"></a>    <span class="co"># --- Convert group lists ---</span></span>
<span id="cb43-69"><a href="#cb43-69" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> groupreg:</span>
<span id="cb43-70"><a href="#cb43-70" aria-hidden="true" tabindex="-1"></a>        gx <span class="op">=</span> pd.concat(green_x).values <span class="cf">if</span> green_x <span class="cf">else</span> <span class="va">None</span></span>
<span id="cb43-71"><a href="#cb43-71" aria-hidden="true" tabindex="-1"></a>        gy <span class="op">=</span> pd.concat(green_y).values <span class="cf">if</span> green_y <span class="cf">else</span> <span class="va">None</span></span>
<span id="cb43-72"><a href="#cb43-72" aria-hidden="true" tabindex="-1"></a>        nx <span class="op">=</span> pd.concat(nongreen_x).values <span class="cf">if</span> nongreen_x <span class="cf">else</span> <span class="va">None</span></span>
<span id="cb43-73"><a href="#cb43-73" aria-hidden="true" tabindex="-1"></a>        ny <span class="op">=</span> pd.concat(nongreen_y).values <span class="cf">if</span> nongreen_y <span class="cf">else</span> <span class="va">None</span></span>
<span id="cb43-74"><a href="#cb43-74" aria-hidden="true" tabindex="-1"></a>        sx <span class="op">=</span> pd.concat(some_x).values <span class="cf">if</span> some_x <span class="cf">else</span> <span class="va">None</span></span>
<span id="cb43-75"><a href="#cb43-75" aria-hidden="true" tabindex="-1"></a>        sy <span class="op">=</span> pd.concat(some_y).values <span class="cf">if</span> some_y <span class="cf">else</span> <span class="va">None</span></span>
<span id="cb43-76"><a href="#cb43-76" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-77"><a href="#cb43-77" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> panelreg:</span>
<span id="cb43-78"><a href="#cb43-78" aria-hidden="true" tabindex="-1"></a>        <span class="co"># --- Panel-wide regression ---</span></span>
<span id="cb43-79"><a href="#cb43-79" aria-hidden="true" tabindex="-1"></a>        all_x <span class="op">=</span> pd.concat(all_data1).values</span>
<span id="cb43-80"><a href="#cb43-80" aria-hidden="true" tabindex="-1"></a>        all_y <span class="op">=</span> pd.concat(all_data2).values</span>
<span id="cb43-81"><a href="#cb43-81" aria-hidden="true" tabindex="-1"></a>        sns.regplot(</span>
<span id="cb43-82"><a href="#cb43-82" aria-hidden="true" tabindex="-1"></a>            x<span class="op">=</span>all_x, y<span class="op">=</span>all_y,</span>
<span id="cb43-83"><a href="#cb43-83" aria-hidden="true" tabindex="-1"></a>            scatter<span class="op">=</span><span class="va">False</span>, ci<span class="op">=</span><span class="va">None</span>,</span>
<span id="cb43-84"><a href="#cb43-84" aria-hidden="true" tabindex="-1"></a>            label<span class="op">=</span><span class="st">'Panel-Wide Regression'</span>,</span>
<span id="cb43-85"><a href="#cb43-85" aria-hidden="true" tabindex="-1"></a>            line_kws<span class="op">=</span>{<span class="st">'color'</span>: <span class="st">'blue'</span>, <span class="st">'linewidth'</span>: <span class="dv">4</span>, <span class="st">'alpha'</span>: <span class="fl">0.2</span>}</span>
<span id="cb43-86"><a href="#cb43-86" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb43-87"><a href="#cb43-87" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-88"><a href="#cb43-88" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> groupreg:</span>
<span id="cb43-89"><a href="#cb43-89" aria-hidden="true" tabindex="-1"></a>        <span class="co"># --- Group Regressions ---</span></span>
<span id="cb43-90"><a href="#cb43-90" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> gx <span class="kw">is</span> <span class="kw">not</span> <span class="va">None</span>:</span>
<span id="cb43-91"><a href="#cb43-91" aria-hidden="true" tabindex="-1"></a>            sns.regplot(</span>
<span id="cb43-92"><a href="#cb43-92" aria-hidden="true" tabindex="-1"></a>                x<span class="op">=</span>gx, y<span class="op">=</span>gy,</span>
<span id="cb43-93"><a href="#cb43-93" aria-hidden="true" tabindex="-1"></a>                scatter<span class="op">=</span><span class="va">False</span>, ci<span class="op">=</span><span class="va">None</span>,</span>
<span id="cb43-94"><a href="#cb43-94" aria-hidden="true" tabindex="-1"></a>                label<span class="op">=</span><span class="st">'Aligned Companies'</span>,</span>
<span id="cb43-95"><a href="#cb43-95" aria-hidden="true" tabindex="-1"></a>                line_kws<span class="op">=</span>{<span class="st">'color'</span>: <span class="st">'green'</span>, <span class="st">'linewidth'</span>: <span class="dv">5</span>, <span class="st">'alpha'</span>: <span class="fl">0.2</span>}</span>
<span id="cb43-96"><a href="#cb43-96" aria-hidden="true" tabindex="-1"></a>            )</span>
<span id="cb43-97"><a href="#cb43-97" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-98"><a href="#cb43-98" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> nx <span class="kw">is</span> <span class="kw">not</span> <span class="va">None</span>:</span>
<span id="cb43-99"><a href="#cb43-99" aria-hidden="true" tabindex="-1"></a>            sns.regplot(</span>
<span id="cb43-100"><a href="#cb43-100" aria-hidden="true" tabindex="-1"></a>                x<span class="op">=</span>nx, y<span class="op">=</span>ny,</span>
<span id="cb43-101"><a href="#cb43-101" aria-hidden="true" tabindex="-1"></a>                scatter<span class="op">=</span><span class="va">False</span>, ci<span class="op">=</span><span class="va">None</span>,</span>
<span id="cb43-102"><a href="#cb43-102" aria-hidden="true" tabindex="-1"></a>                label<span class="op">=</span><span class="st">'Unprepared Companies'</span>,</span>
<span id="cb43-103"><a href="#cb43-103" aria-hidden="true" tabindex="-1"></a>                line_kws<span class="op">=</span>{<span class="st">'color'</span>: <span class="st">'red'</span>, <span class="st">'linewidth'</span>: <span class="dv">5</span>, <span class="st">'alpha'</span>: <span class="fl">0.2</span>}</span>
<span id="cb43-104"><a href="#cb43-104" aria-hidden="true" tabindex="-1"></a>            )</span>
<span id="cb43-105"><a href="#cb43-105" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-106"><a href="#cb43-106" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> sx <span class="kw">is</span> <span class="kw">not</span> <span class="va">None</span>:</span>
<span id="cb43-107"><a href="#cb43-107" aria-hidden="true" tabindex="-1"></a>            sns.regplot(</span>
<span id="cb43-108"><a href="#cb43-108" aria-hidden="true" tabindex="-1"></a>                x<span class="op">=</span>sx, y<span class="op">=</span>sy,</span>
<span id="cb43-109"><a href="#cb43-109" aria-hidden="true" tabindex="-1"></a>                scatter<span class="op">=</span><span class="va">False</span>, ci<span class="op">=</span><span class="va">None</span>,</span>
<span id="cb43-110"><a href="#cb43-110" aria-hidden="true" tabindex="-1"></a>                label<span class="op">=</span><span class="st">'Developing Companies'</span>,</span>
<span id="cb43-111"><a href="#cb43-111" aria-hidden="true" tabindex="-1"></a>                line_kws<span class="op">=</span>{<span class="st">'color'</span>: <span class="st">'gray'</span>, <span class="st">'linewidth'</span>: <span class="dv">5</span>, <span class="st">'alpha'</span>: <span class="fl">0.2</span>}</span>
<span id="cb43-112"><a href="#cb43-112" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb43-113"><a href="#cb43-113" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-114"><a href="#cb43-114" aria-hidden="true" tabindex="-1"></a>    <span class="co"># --- Formatting ---</span></span>
<span id="cb43-115"><a href="#cb43-115" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> xlog:</span>
<span id="cb43-116"><a href="#cb43-116" aria-hidden="true" tabindex="-1"></a>        plt.xscale(<span class="st">'log'</span>)</span>
<span id="cb43-117"><a href="#cb43-117" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> ylog:</span>
<span id="cb43-118"><a href="#cb43-118" aria-hidden="true" tabindex="-1"></a>        plt.yscale(<span class="st">'log'</span>)</span>
<span id="cb43-119"><a href="#cb43-119" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-120"><a href="#cb43-120" aria-hidden="true" tabindex="-1"></a>    plt.title(<span class="ss">f'</span><span class="sc">{</span>label1<span class="sc">}</span><span class="ss"> vs. </span><span class="sc">{</span>label2<span class="sc">}</span><span class="ss">'</span>, fontsize<span class="op">=</span><span class="dv">14</span>)</span>
<span id="cb43-121"><a href="#cb43-121" aria-hidden="true" tabindex="-1"></a>    plt.xlabel(label1)</span>
<span id="cb43-122"><a href="#cb43-122" aria-hidden="true" tabindex="-1"></a>    plt.ylabel(label2)</span>
<span id="cb43-123"><a href="#cb43-123" aria-hidden="true" tabindex="-1"></a>    plt.grid(<span class="va">True</span>, ls<span class="op">=</span><span class="st">"--"</span>, alpha<span class="op">=</span><span class="fl">0.6</span>)</span>
<span id="cb43-124"><a href="#cb43-124" aria-hidden="true" tabindex="-1"></a>    plt.legend(loc<span class="op">=</span><span class="st">'center left'</span>, bbox_to_anchor<span class="op">=</span>(<span class="fl">1.02</span>, <span class="fl">0.5</span>), frameon<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb43-125"><a href="#cb43-125" aria-hidden="true" tabindex="-1"></a>    plt.tight_layout()</span>
<span id="cb43-126"><a href="#cb43-126" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-127"><a href="#cb43-127" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-128"><a href="#cb43-128" aria-hidden="true" tabindex="-1"></a>Quick_scatter(ROE, ESG, <span class="st">"Returns on Equity"</span>, <span class="st">"ESG score"</span>)</span>
<span id="cb43-129"><a href="#cb43-129" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-130"><a href="#cb43-130" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-131"><a href="#cb43-131" aria-hidden="true" tabindex="-1"></a>Quick_scatter(ROA, ESG, <span class="st">"Returns on Assets"</span>, <span class="st">"ESG score"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="Groupwork_files/figure-html/cell-36-output-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="Groupwork_files/figure-html/cell-36-output-2.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
</section>
</section>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
        const codeEl = trigger.previousElementSibling.cloneNode(true);
        for (const childEl of codeEl.children) {
          if (isCodeAnnotation(childEl)) {
            childEl.remove();
          }
        }
        return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
    const viewSource = window.document.getElementById('quarto-view-source') ||
                       window.document.getElementById('quarto-code-tools-source');
    if (viewSource) {
      const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
      viewSource.addEventListener("click", function(e) {
        if (sourceUrl) {
          // rstudio viewer pane
          if (/\bcapabilities=\b/.test(window.location)) {
            window.open(sourceUrl);
          } else {
            window.location.href = sourceUrl;
          }
        } else {
          const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
          modal.show();
        }
        return false;
      });
    }
    function toggleCodeHandler(show) {
      return function(e) {
        const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
        for (let i=0; i<detailsSrc.length; i++) {
          const details = detailsSrc[i].parentElement;
          if (show) {
            details.open = true;
          } else {
            details.removeAttribute("open");
          }
        }
        const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
        const fromCls = show ? "hidden" : "unhidden";
        const toCls = show ? "unhidden" : "hidden";
        for (let i=0; i<cellCodeDivs.length; i++) {
          const codeDiv = cellCodeDivs[i];
          if (codeDiv.classList.contains(fromCls)) {
            codeDiv.classList.remove(fromCls);
            codeDiv.classList.add(toCls);
          } 
        }
        return false;
      }
    }
    const hideAllCode = window.document.getElementById("quarto-hide-all-code");
    if (hideAllCode) {
      hideAllCode.addEventListener("click", toggleCodeHandler(false));
    }
    const showAllCode = window.document.getElementById("quarto-show-all-code");
    if (showAllCode) {
      showAllCode.addEventListener("click", toggleCodeHandler(true));
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp('/' + window.location.host + '/');
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
</div> <!-- /content -->




</body></html>